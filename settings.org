#+setupfile: "~/.emacs.d/public/blog/setup-it.org"

#+LANGUAGE: ru
#+PROPERTY: results silent

* DONE –ú–æ–π –∫–æ–Ω—Ñ–∏–≥ Emacs –≤ —Ñ–æ—Ä–º–∞—Ç–µ org-mode                            :emacs:
  :PROPERTIES:
  :EXPORT_FILE_NAME: my-emacs-config
  :END:

** –û–ø–∏—Å–∞–Ω–∏–µ

 –≠—Ç–æ—Ç –∫–æ–Ω—Ñ–∏–≥ –∏—Å–ø–æ–ª—å–∑—É—é –Ω–∞ –≤—Å–µ—Ö –¥–µ—Å–∫—Ç–æ–ø–∞—Ö –∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞—Ö. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –æ–Ω –ø–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è. –ê–∫—Ç—É–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é –≤—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ —Ä–∞–±–æ—á–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:
 [[https://github.com/johnlepikhin/emacs-public/blob/master/settings.org]].

 –ò–∑ –Ω–µ–≥–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è —Ñ–∞–π–ª—ã:
  * ~/.emacs.d/local/user-info.org : –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ email, –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ç.–¥.
  * ~/.emacs.d/local/org-agenda.org : –ª–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —à–∞–±–ª–æ–Ω–æ–≤ agenda
  * ~/.emacs.d/local/org-capture.org : –ª–∏—á–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã org-–∑–∞–ø–∏—Å–µ–π
  * ~/.emacs.d/local/gnus-accounts.org : –ø–æ—á—Ç–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã
  * ~/.emacs.d/local/gnus-templates.org : –ø–æ—á—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã

*** –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∞—Ç—å

 –í ~/.emacs –Ω–∞–¥–æ –Ω–∞–ø–∏—Å–∞—Ç—å:

 #+BEGIN_EXAMPLE
 (package-initialize)

 (defun my-load-org-config (subpath)
   (let ((ini-file (expand-file-name subpath user-emacs-directory)))
	 (condition-case errinfo (org-babel-load-file ini-file)
	   (error (message "Cannot load settings for file %s: %s" ini-file errinfo)))))

 (my-load-org-config "public/settings.org")
 #+END_EXAMPLE

 –ó–¥–µ—Å—å public/settings.org –±—É–¥–µ—Ç —Ç—Ä–∞–Ω—Å–ª–∏—Ä–æ–≤–∞–Ω–æ –≤ ~/.emacs.d/public/settings.org, —Å–æ–≥–ª–∞—Å–Ω–æ –∑–Ω–∞—á–µ–Ω–∏—é user-emacs-directory.

** –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

 –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–¥–µ—Å—å –ª–µ–∫—Å–∏—á–µ—Å–∫–∏ –ª–æ–∫–∞–ª—å–Ω—ã:

 #+BEGIN_SRC emacs-lisp
 (setq-local lexical-binding t)
 #+END_SRC

 –°–æ–±—Ä–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ use-package. –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–∂–Ω–æ –ø–æ–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏ use-package-report –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å.

 #+BEGIN_SRC emacs-lisp
 (setq use-package-compute-statistics t)
 #+END_SRC

*** –í–Ω–µ—à–Ω–∏–π –≤–∏–¥

 –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

 #+BEGIN_SRC emacs-lisp
   (setq auto-revert-interval 1            ; Refresh buffers fast
         custom-file (make-temp-file "")   ; Discard customization's
         default-input-method "TeX"        ; Use TeX when toggling input method
         echo-keystrokes 0.1               ; Show keystrokes asap
         inhibit-startup-message t         ; No splash screen please
         initial-scratch-message nil       ; Clean scratch buffer
         sentence-end-double-space nil)    ; No double space
 #+END_SRC

 –í—ã–∫–ª—é—á–∏—Ç—å –∫–Ω–æ–ø–∫—É Insert (–≤–∫–ª—é—á–µ–Ω–∏–µ overwrite-mode):

 #+BEGIN_SRC emacs-lisp
 (define-key global-map [(insert)] nil)
 #+END_SRC

 –í—ã–∫–ª—é—á–∏—Ç—å —Ç—É–ª–±–∞—Ä:

 #+BEGIN_SRC emacs-lisp
 (tool-bar-mode -1)
 #+END_SRC

 –®–∏—Ä–∏–Ω–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–æ–ª—å—à–∞—è, —Å–µ–π—á–∞—Å —à–∏—Ä–æ–∫–∏–µ –º–æ–Ω–∏—Ç–æ—Ä—ã:

 #+BEGIN_SRC emacs-lisp
 (setq-default fill-column 140)
 #+END_SRC

 –ù–µ –Ω–∞–¥–æ –º–Ω–µ —Å–æ–æ–±—â–∞—Ç—å, —á—Ç–æ —É —Å—Ç—Ä–æ–∫–∏ –µ—Å—Ç—å –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ. –ü—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–π –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –Ω–∞
 —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–æ–∫–µ:

 #+BEGIN_SRC emacs-lisp
 (setq-default truncate-lines t)
 #+END_SRC

*** –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º—ã

 #+BEGIN_SRC emacs-lisp
   (load-theme 'leuven t)
 #+END_SRC

*** –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–∫–µ—Ç–æ–≤ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

 –ü–æ–¥–∫–ª—é—á–∏—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–∫–µ—Ç–æ–≤:

 #+BEGIN_SRC emacs-lisp
 (require 'package)

 (add-to-list 'package-archives '("melpa" . "http://melpa.org/packages/"))
 (add-to-list 'package-archives '("melpa-stable" . "https://stable.melpa.org/packages/"))
 (add-to-list 'package-archives '("org" . "http://orgmode.org/elpa/") t)
 #+END_SRC

 –ü—Ä–∏–±–∏—Ç—å –≥–≤–æ–∑–¥—è–º–∏ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º:

 #+BEGIN_SRC emacs-lisp
 (add-to-list 'package-pinned-packages '(cider . "melpa-stable") t)
 #+END_SRC

 –ü–æ—Å—Ç–∞–≤–∏—Ç—å –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã, –µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:

 #+BEGIN_SRC emacs-lisp
 (dolist (package
          '(use-package))
   (if (not (package-installed-p package))
     (progn
       (message "Installing package %s" package)
     (package-refresh-contents)
       (package-install package))))
 #+END_SRC

 –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º use-package:

 #+BEGIN_SRC emacs-lisp
 (require 'use-package)
 (setq use-package-always-ensure t)
 #+END_SRC

 –ë–æ–ª—å—à–µ –¥–µ–±–∞–≥–∞ –¥–ª—è use-package:

 #+BEGIN_SRC emacs-lisp
 (setq use-package-verbose t)
 #+END_SRC

 –Ø —Ö–æ—á—É —É–∫–∞–∑—ã–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∫ —Å–∏—Å—Ç–µ–º–Ω—ã–º –ø–∞–∫–µ—Ç–∞–º –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ use-package:

 #+BEGIN_SRC emacs-lisp
 (use-package use-package-ensure-system-package
   :ensure t)
 #+END_SRC

 –ü—Ä–æ–¥—É–±–ª–∏—Ä—É–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ, –ø–æ–¥–≥—Ä—É–∂–∞—é—â–µ–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ ~/.emacs:

 #+BEGIN_SRC emacs-lisp
 (defun my-load-org-config (subpath)
   (let ((ini-file (expand-file-name subpath user-emacs-directory)))
	 (condition-case errinfo
		 (progn
		   (org-babel-load-file ini-file)
		   (message "Loaded config: %s" subpath))
	   (error (message "Cannot load settings for file %s: %s" ini-file errinfo)))))
 #+END_SRC

*** –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

 #+BEGIN_SRC emacs-lisp
 (my-load-org-config "local/user-info.org")
 #+END_SRC

** –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–≤–æ–¥–∞

 –£ –º–µ–Ω—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞—Å–∫–ª–∞–¥–∫–∏ –≤–Ω—É—Ç—Ä–∏ Emacs –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ —Å XMonad. –ù–∏–∂–µ—Å–ª–µ–¥—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–ª—É–∂–∞—Ç —ç—Ç–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.

 #+BEGIN_SRC emacs-lisp
 (defun my-update-cursor ()
   (set-cursor-color
    (if (string= current-input-method "russian-computer") "red" "black")))

 (add-hook 'buffer-list-update-hook 'my-update-cursor)

 (defun my-update-isearch-input-method ()
   (if isearch-mode
       (progn
         (setq isearch-input-method-function input-method-function
               isearch-input-method-local-p t)
         (isearch-update))))

 (defun my-update-input-method (is-ru)
   (if is-ru
       (set-input-method 'russian-computer)
     (inactivate-input-method))
   (my-update-isearch-input-method)
   (my-update-cursor))

 (defun my-select-input-eng ()
   (interactive)
   (my-update-input-method nil))

 (defun my-select-input-rus ()
   (interactive)
   (my-update-input-method t))

 (global-set-key (kbd "<M-f11>") 'my-select-input-eng)
 (global-set-key (kbd "<M-f12>") 'my-select-input-rus)
 (define-key isearch-mode-map (kbd "<M-f11>") 'my-select-input-eng)
 (define-key isearch-mode-map (kbd "<M-f12>") 'my-select-input-rus)
 #+END_SRC

 –°—Ç—Ä–∞–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –¥–æ–±–∞–≤–∏—Ç—å –µ—â—ë –æ–¥–Ω—É —Ä–∞—Å–∫–ª–∞–¥–∫—É:

 #+BEGIN_SRC emacs-lisp
 (set-input-method 'russian-computer)
 (toggle-input-method)
 #+END_SRC

 –°–æ–∑–¥–∞–µ–º –ª–∏—á–Ω—É—é –∫–∞—Ä—Ç—É –∞–∫–∫–æ—Ä–¥–æ–≤:

 #+BEGIN_SRC emacs-lisp
 (defvar my-bindings-map (make-keymap)
   "–ú–æ–∏ –ª–∏—á–Ω—ã–µ –≥–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏–≥–∏.")

 (define-minor-mode my-bindings-mode
   "–†–µ–∂–∏–º –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –º–æ–∏—Ö –∫–Ω–æ–ø–æ–∫."
   t nil my-bindings-map)

 (define-key my-bindings-map (kbd "C-c <up>")    'windmove-up)
 (define-key my-bindings-map (kbd "C-c <down>")  'windmove-down)
 (define-key my-bindings-map (kbd "C-c <left>")  'windmove-left)
 (define-key my-bindings-map (kbd "C-c <right>") 'windmove-right)
 (define-key my-bindings-map [C-return] (lambda () (interactive) (point-to-register 'r)))
 (define-key my-bindings-map [M-return] (lambda () (interactive) (jump-to-register 'r)))
 #+END_SRC

 –ó–∞—á–µ–º –º–Ω–µ –∑–∞–º–æ—Ä–∞–∂–∏–≤–∞—Ç—å —Ñ—Ä–µ–π–º—ã?

 #+BEGIN_SRC emacs-lisp
 (global-unset-key (kbd "C-z"))
 #+END_SRC

*** Expand region

 –ü–æ –Ω–∞–∂–∞—Ç–∏—é ~C-=~ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–µ–≥–∏–æ–Ω —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏/—Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è:

 #+BEGIN_SRC emacs-lisp
 (use-package
   expand-region
   :bind (:map my-bindings-map
               ("C-=" . er/expand-region)))
 #+END_SRC

** –í–Ω–µ—à–Ω–∏–π –≤–∏–¥

–ó–æ–ª–æ—Ç–æ–µ —Å–µ—á–µ–Ω–∏–µ –¥–ª—è —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è –æ–∫–æ–Ω:

 #+BEGIN_SRC emacs-lisp
 (use-package zoom
   :commands zoom-mode
   :config
   (setq zoom-ignored-major-modes '(gnus-summary-mode))
   (setq zoom-size '(0.618 . 0.618)))
 (zoom-mode t)
 #+END_SRC

–£–¥–æ–±–Ω–æ–µ —Ö–æ–∂–¥–µ–Ω–∏–µ –ø–æ –æ–∫–Ω–∞–º:

#+BEGIN_SRC emacs-lisp
(use-package ace-window
  :defer t
  :bind (:map my-bindings-map
              ("M-o" . ace-window)))
#+END_SRC

–ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ –≤–≤–æ–¥–∏–º—ã–º –∫–Ω–æ–ø–∫–∞–º. –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –≤ 1 —Å–µ–∫—É–Ω–¥—É:

 #+BEGIN_SRC emacs-lisp
 (use-package
   which-key
   :config 
   (setq which-key-idle-delay 1)
   (which-key-mode))
 #+END_SRC

–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ –º–∏–Ω–∏–±—É—Ñ–µ—Ä–µ –ø–æ–∑–∏—Ü–∏—é –≤ —Å—Ç—Ä–æ–∫–µ:

 #+BEGIN_SRC emacs-lisp
 (column-number-mode)
 #+END_SRC

*** Imenu

#+BEGIN_SRC emacs-lisp
(use-package
  imenu
  :bind (:map my-bindings-map
              ("M-'" . imenu-list-smart-toggle)))
#+END_SRC


*** –í—ã–∫–ª—é—á–∏—Ç—å menu-bar, –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ F10

#+BEGIN_SRC emacs-lisp
(menu-bar-mode -1)

(defun my-toggle-menu-bar ()
  (interactive)
  (toggle-menu-bar-mode-from-frame 'toggle))

(define-key my-bindings-map (kbd "<f10>") 'my-toggle-menu-bar)
#+END_SRC


** –ü–æ–≤–µ–¥–µ–Ω–∏–µ

 –ë—ç–∫–∞–ø—ã –Ω–µ –Ω—É–∂–Ω—ã:

 #+BEGIN_SRC emacs-lisp
 (setq backup-inhibited t)
 #+END_SRC

 –®–∞–≥ –æ—Ç—Å—Ç—É–ø–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 4 —Å–∏–º–≤–æ–ª–∞:

 #+BEGIN_SRC emacs-lisp
 (setq-default tab-width 4) 
 (setq-default standart-indent 4)
 #+END_SRC

 –Ø –ª—é–±–ª—é –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏ –¥–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞, –Ω–µ –Ω–∞–¥–æ –º–µ–Ω—è –≤–æ—Ä–Ω–∏—Ç—å:

 #+BEGIN_SRC emacs-lisp
 (put 'narrow-to-region 'disabled nil)
 #+END_SRC

 –ò—Å—Ç–æ—Ä–∏—è –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤:

 #+BEGIN_SRC emacs-lisp
 (use-package
   recentf
   :config
   (setq recentf-max-saved-items 100)
   (setq recentf-max-menu-items 25)
   (recentf-mode 1))
 #+END_SRC

 –ü–æ–º–Ω–∏—Ç—å –ø–æ–∑–∏—Ü–∏–∏ –≤ —Ñ–∞–π–ª–∞—Ö:

 #+BEGIN_SRC emacs-lisp
 (save-place-mode 1)
 #+END_SRC

 –ü–æ–º–∏–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∫–æ–º–∞–Ω–¥ –º–∏–Ω–∏–±—É—Ñ–µ—Ä–∞:

 #+BEGIN_SRC emacs-lisp
 (savehist-mode 1)
 #+END_SRC

 –ë—Ä–∞—É–∑–µ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî chromium:

 #+BEGIN_SRC emacs-lisp
 (setq browse-url-browser-function 'browse-url-chromium)
 #+END_SRC

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ivy –≤ –∫–∞—á–µ—Å—Ç–≤–µ –¥–≤–∏–∂–∫–∞ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∏–º–µ–Ω –±—É—Ñ–µ—Ä–æ–≤, —Ñ–∞–π–ª–æ–≤ –∏ —Ç.–¥.

[2019-09-23 Mon] –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏–ª —Ç.–∫. —Ç–æ—Ä–º–æ–∑–∏—Ç –Ω–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–∞—Ö.

# #+BEGIN_SRC emacs-lisp
# (use-package ivy
#   :defer 0.1
#   :diminish
#   :bind (("C-c C-r" . ivy-resume)
#          ("C-x B" . ivy-switch-buffer-other-window))
#   :custom
#   (ivy-count-format "(%d/%d) ")
#   (ivy-use-virtual-buffers t)
#   :config (ivy-mode))

# (use-package counsel
#   :after ivy
#   :config (counsel-mode))
# #+END_SRC

–ò—â–µ–º swiper'–æ–º:

[2019-09-23 Mon] –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏–ª —Ç.–∫. —Ç–æ—Ä–º–æ–∑–∏—Ç –Ω–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–∞—Ö.

# #+BEGIN_SRC emacs-lisp
# (use-package swiper
#   :after ivy
#   :bind (("C-s" . swiper)
#          ("C-r" . swiper)))
# #+END_SRC




*** –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –±—É—Ñ–µ—Ä–æ–≤

[2019-09-23 Mon] –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏–ª —Ç.–∫. —Ç–æ—Ä–º–æ–∑–∏—Ç –Ω–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–∞—Ö.

#     #+BEGIN_SRC emacs-lisp
# (use-package
#   ibuffer
#   :bind (:map my-bindings-map
#                ("C-x C-b" . ibuffer))
#   :hook ((ibuffer-mode . hl-line-mode)))
# #+END_SRC

*** –ù–∞—Å—Ç—Ä–æ–π–∫–∏ isearch

 –£ –º–µ–Ω—è –ø–ª–æ—Ö–æ –ø—Ä–∏–∂–∏–ª–∏—Å—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–Ω–æ–ø–∫–∏, —Å–ª–µ–≥–∫–∞ –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∏–ª:

 #+BEGIN_SRC emacs-lisp
 (define-key isearch-mode-map (kbd "<up>") 'isearch-ring-retreat )
 (define-key isearch-mode-map (kbd "<down>") 'isearch-ring-advance )

 (define-key isearch-mode-map (kbd "<left>") 'isearch-repeat-backward)
 (define-key isearch-mode-map (kbd "<right>") 'isearch-repeat-forward)

 (define-key minibuffer-local-isearch-map (kbd "<left>") 'isearch-reverse-exit-minibuffer)
 (define-key minibuffer-local-isearch-map (kbd "<right>") 'isearch-forward-exit-minibuffer)
 #+END_SRC

** –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

 –ú–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–π —Ä–µ–∂–∏–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

 #+BEGIN_SRC emacs-lisp
 (setq comment-style 'multi-line)
 #+END_SRC

 –£ –Ω–∞—Å –Ω–µ –ø—Ä–∏–Ω—è—Ç–æ —Ä–∞–∑–¥–µ–ª—è—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–≤–æ–π–Ω—ã–º –ø—Ä–æ–±–µ–ª–æ–º:

 #+BEGIN_SRC emacs-lisp
 (setq sentence-end-double-space nil)
 #+END_SRC

 –ú—ã –ø—Ä–µ–∑–∏—Ä–∞–µ–º —Ç–∞–±—É–ª—è–ª—Ü–∏—é –≤ –æ—Ç—Å—Ç—É–ø–∞—Ö:

 #+BEGIN_SRC emacs-lisp
 (setq-default indent-tabs-mode nil)
 #+END_SRC

*** Yasnippet: —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ —Å–Ω–∏–ø–ø–µ—Ç–æ–≤

 #+BEGIN_SRC emacs-lisp
 (use-package yasnippet
   :bind 
   (:map my-bindings-map
         ("C-<tab>" . yas-expand))
   ;; —è –Ω–µ –ª—é–±–ª—é, –∫–æ–≥–¥–∞ –ø–æ tab-—É –º–Ω–µ –ø—ã—Ç–∞—é—Ç—Å—è —á—Ç–æ-—Ç–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å
   (:map yas-minor-mode-map
         ("<tab>" . nil)
         ("TAB" . nil))
   :hook ((cperl-mode org-mode) . yas-minor-mode)
   :commands (yas-minor-mode)
   :after (yasnippet-classic-snippets)
   :config
   ;; –ø–æ–¥–∫–ª—é—á–∏—Ç—å –º–æ–π –ø—É–±–ª–∏—á–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–Ω–∏–ø–ø–µ—Ç–æ–≤
   (add-to-list 'yas-snippet-dirs (expand-file-name "~/.emacs.d/public/yasnippets"))
   ;; —Ç–µ–ø–µ—Ä—å –Ω–∞–¥–æ –≤—Å—ë –ø–µ—Ä–µ—á–∏—Ç–∞—Ç—å
   (yas-reload-all))

 (use-package yasnippet-classic-snippets)
 #+END_SRC

*** –£–¥–∞–ª–µ–Ω–∏–µ –±–µ–∑ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è kill-ring

 –ù–µ –ª—é–±–ª—é, –∫–æ–≥–¥–∞ —É–¥–∞–ª—è–µ–º—ã–µ –∫—É—Å–∫–∏ —Ç–µ–∫—Å—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–æ–º –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞. –ö—É—Å–æ—á–∫–∏ –∫–æ–¥–∞ –æ—Ç–∫—É–¥–∞-—Ç–æ —Å–ø—ë—Ä.

 #+BEGIN_SRC emacs-lisp
 (defun my-delete-word (arg)
   "Delete characters forward until encountering the end of a word.
 With argument, do this that many times.
 This command does not push text to `kill-ring'."
   (interactive "p")
   (delete-region
    (point)
    (progn
      (forward-word arg)
      (point))))

 (defun my-backward-delete-word (arg)
   "Delete characters backward until encountering the beginning of a word.
 With argument, do this that many times.
 This command does not push text to `kill-ring'."
   (interactive "p")
   (my-delete-word (- arg)))

 (define-key my-bindings-map (kbd "C-S-k") 'my-delete-line-backward)
 (define-key my-bindings-map (kbd "M-d") 'my-delete-word)
 (define-key my-bindings-map (kbd "<M-backspace>") 'my-backward-delete-word)
 (define-key my-bindings-map (kbd "<C-backspace>") 'my-backward-delete-word)
 #+END_SRC

*** –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ—Ç—Å—Ç—É–ø—ã

–û—Ç–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º –¥–ª—è —Ñ–∞–π–ª–æ–≤ –±–æ–ª—å—à–µ 100K:

#+BEGIN_SRC emacs-lisp
(defun my-disable-indent-guide-mode-for-big-buffer ()
  (when (> (buffer-size) 100000)
    (progn
      (message "Buffer is too big, disable guided indent mode")
      (indent-guide-mode -1))))
#+END_SRC

 #+BEGIN_SRC emacs-lisp
 (use-package
   indent-guide
   :hook ((prog-mode . indent-guide-mode)
          (find-file . my-disable-indent-guide-mode-for-big-buffer))
   :config
   (setq indent-guide-char "|")
   (set-face-foreground 'indent-guide-face "darkgray"))
 #+END_SRC

*** –£–º–Ω—ã–µ —Å–∫–æ–±–æ—á–∫–∏

 #+BEGIN_SRC emacs-lisp
 (use-package
   smartparens
   :config
   ;; –ï—Å—Ç—å –±–∞–≥ —Å electric-parens-mode —Å cperl, –∑–∞–ø–ª–∞—Ç–∫–∞ –∏–∑ https://github.com/syl20bnr/spacemacs/issues/480
   (with-eval-after-load 'cperl-mode
	 (add-hook 'smartparens-enabled-hook  (lambda () (define-key cperl-mode-map "{" nil)))
	 (add-hook 'smartparens-disabled-hook  (lambda () (define-key cperl-mode-map "{" 'cperl-electric-lbrace))))
   ;; –í–∫–ª—é—á–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω–æ
   (smartparens-global-mode 1))
 #+END_SRC

 –ü–æ–¥—Å–≤–µ—á–∏–≤–∞—Ç—å –ø–∞—Ä–Ω—É—é —Å–∫–æ–±–∫—É, –ø–µ—Ä–µ—Ö–æ–¥—ã –ø–æ –Ω–∏–º:

 #+BEGIN_SRC emacs-lisp
 (show-paren-mode 1)
 (setq show-paren-delay 0)

 (defun match-paren (arg)
   "Go to the matching paren."
   (interactive "p")
   (cond ((looking-at "\\s\(") (forward-list 1) (backward-char 1))
         ((looking-at "\\s\)") (forward-char 1) (backward-list 1))
         (t (self-insert-command (or arg 1)))))

 (define-key my-bindings-map (kbd "C-`") 'match-paren)
 #+END_SRC

*** –î–µ—Ä–µ–≤–æ –æ—Ç–º–µ–Ω—ã

 #+BEGIN_SRC emacs-lisp
 (use-package
   undo-tree
   :bind (:map my-bindings-map
               ("C-x u" . undo-tree-visualize))
   :config (global-undo-tree-mode 1))
 #+END_SRC

*** –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ

 #+BEGIN_SRC emacs-lisp
 (use-package
   company
   :hook (prog-mode . company-mode)
   :config
   ;; —Å–Ω–∞—á–∞–ª–∞ –∏—â–µ–º –≤ gtags, –∞ –µ—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ ‚Äî —Å–º–æ—Ç—Ä–∏–º –≤ abbrev
   (add-to-list 'company-backends '(company-gtags :with company-dabbrev))
   ;; –ø–æ –∫–Ω–æ–ø–∫–µ TAB –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ, –∏ –≤—ã–±–æ—Ä –≤–∞—Ä–∏–∞–Ω—Ç–∞
;;   (company-tng-configure-default)
   (setq company-idle-delay 0
         company-echo-delay 0
         company-dabbrev-downcase nil
         company-show-numbers t
         company-minimum-prefix-length 2
         company-selection-wrap-around t
         company-transformers '(company-sort-by-occurrence
                                company-sort-by-backend-importance)))
 #+END_SRC

**** –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Å –Ω–µ—Ç–æ—á–Ω—ã–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ–º

–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ —Ç–∞–∫ –º–Ω–æ–≥–æ –±—ç–∫–µ–Ω–¥–æ–≤ company. –Ø –∏—Å–ø–æ–ª—å–∑—É—é —Ç–æ–ª—å–∫–æ –¥–ª—è lisp.

 #+BEGIN_SRC emacs-lisp
 (use-package company-flx
   :demand t
   :init
   (company-flx-mode +1))
 #+END_SRC

**** –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ company

#+BEGIN_SRC emacs-lisp
(use-package company-quickhelp
  :ensure t
  :hook (global-company-mode . company-quickhelp-mode)
  :commands (company-quickhelp-mode)
  :defer t
  :init (add-hook 'global-company-mode-hook #'company-quickhelp-mode))
#+END_SRC


*** Tramp

 #+BEGIN_SRC emacs-lisp
 (use-package
   tramp
   :config (setq tramp-use-ssh-controlmaster-options nil))
 #+END_SRC

*** drug-staff

–¢–∞—Å–∫–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–µ –∏–ª–∏ —Å—Ç—Ä–æ—á–∫—É –ø–æ –±—É—Ñ–µ—Ä—É

#+BEGIN_SRC emacs-lisp
(use-package drag-stuff
  :bind (:map my-bindings-map
              ("M-p" . drag-stuff-up)
              ("M-n" . drag-stuff-down)))
#+END_SRC


** –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
*** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏

 –ü–æ–¥–∫–ª—é—á–∞–µ–º projectile:

 #+BEGIN_SRC emacs-lisp
   (use-package
     projectile
     :bind (:map projectile-mode-map
                 ("C-c p" . 'projectile-command-map))
     :config (projectile-mode +1))
 #+END_SRC

 –ü–æ–¥–∫–ª—é—á–∞–µ–º helm –∫ projectile

 #+BEGIN_SRC emacs-lisp
 (use-package
   helm-projectile
   :after (projectile helm)
   :config (helm-projectile-on))
 #+END_SRC

*** –°–±–æ—Ä–∫–∏

#+BEGIN_SRC emacs-lisp
(use-package multi-compile
  :commands (multi-compile multi-compile-run)
  :init
  (setq multi-compile-alist
        '((go-mode . (
                      ("go-build" "go build -v"
                       (locate-dominating-file buffer-file-name ".git"))
                      ("go-build-and-run" "go build -v && echo 'build finish' && eval ./${PWD##*/}"
                       (multi-compile-locate-file-dir ".git"))))
          )))
#+END_SRC


*** Magit

 #+BEGIN_SRC emacs-lisp
 (use-package
   magit
   :bind (:map my-bindings-map
               ("C-x g" . magit-status)))
 #+END_SRC

*** –ò–Ω–¥–µ–∫—Å –ø–æ —Ç—ç–≥–∞–º

 #+BEGIN_SRC emacs-lisp
 (use-package ggtags
   :hook (cperl-mode . ggtags-mode)
   :config
   (setq ggtags-sort-by-nearness nil
         ggtags-navigation-mode-lighter nil
         ggtags-mode-line-project-name nil
         ggtags-oversize-limit (* 30 1024 1024)))
 #+END_SRC

*** Flycheck

 #+BEGIN_SRC emacs-lisp
 (use-package
   flycheck
   :config
   (setq flycheck-idle-change-delay 5)
   ;; –ë–∞–≥—Ñ–∏–∫—Å—ã, —Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–æ–±–ª–µ–º–µ https://github.com/flycheck/flycheck/issues/1278:
   ;; –≤ :preface –Ω–µ–ª—å–∑—è –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ç.–∫. :preface –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª—è
   (advice-add
    'flycheck-process-send-buffer
    :override
    (lambda (process)
      (condition-case err
          (save-restriction
            (widen)
            (if flycheck-chunked-process-input
                (flycheck--process-send-buffer-contents-chunked process)
              (process-send-region process (point-min) (point-max)))
            (process-send-eof process))
        (error
         (let* ((checker (process-get process 'flycheck-checker))
                (type (flycheck-checker-get checker 'standard-input)))
           (when (or (not (eq type 'ignore-error)) (process-live-p process))
             (signal (car err) (cdr err))))))))
   (flycheck-define-checker perl
     "A Perl syntax checker using the Perl interpreter.

     See URL `https://www.perl.org'."
     :command ("perl" "-w" "-c"
               (option-list "-I" flycheck-perl-include-path)
               (option-list "-M" flycheck-perl-module-list concat))
     :standard-input ignore-error
     :error-patterns
     ((error line-start (minimal-match (message))
             " at - line " line
             (or "." (and ", " (zero-or-more not-newline))) line-end))
     :modes (perl-mode cperl-mode)
     :next-checkers (perl-perlcritic))
   (setq flycheck-global-modes '(not org-mode)
         flycheck-display-errors-function nil
         flycheck-display-errors-delay 0
         ;; –ò–Ω–æ–≥–¥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è —Ä–∞–∑–≥—Ä–µ–±–∞—Ç—å —á—É–ª–∞–Ω—ã —Å –≥—Ä–∞–±–ª—è–º–∏, –Ω–∞–¥–æ –≤–∏–¥–µ—Ç—å —Ç—ã—Å—è—á–∏ –æ—à–∏–±–æ–∫ –≤ —Ñ–∞–π–ª–µ
         flycheck-checker-error-threshold 10000)
   (global-flycheck-mode))
 #+END_SRC

 –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –ø—Ä—è–º–æ –Ω–∞ –º–µ—Å—Ç–µ, –ø–æ–¥ —Å—Ç—Ä–æ–∫–æ–π:

 #+BEGIN_SRC emacs-lisp
 (use-package
   flycheck-inline
   :after (flycheck)
   :hook (flycheck-mode . flycheck-inline-mode))
 #+END_SRC

*** Perl

 –¢–∞–±–ª–∏—Ü–∞ —Å–∏–º–≤–æ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:

 #+BEGIN_SRC emacs-lisp
 (defun my-cperl-init-prettify-symbols ()
   (setq prettify-symbols-alist
		 '(("<=" . ?‚â§)
		   ("&&" . ?‚àß)
		   ("||" . ?‚à®)
		   ("!=" . ?‚â†)
		   ("for" . ?‚àÄ)
		   ("foreach" . ?‚àÄ)
		   ("exists" . ?‚àÉ)
		   ("undef" . ?‚àÖ)
		   ("sub" . ?Œª)
		   ("return" . ?‚ä¢)
		   ("//" . ?‚´Ω)
		   ("my" . ?‚â°)
		   ("delete" . ?‚ùå)
		   ("defined" . ?‚ùì)
		   ("!" . ?¬¨)
		   ("not" . ?¬¨)
		   ("join" . ?ùêâ)
		   ("grep" . ?ùêÜ)
		   ("map" . ?ùêå)
		   ("sort" . ?ùêí)
		   (".." . ?‚ã∞)
		   ("next" . ?‚Ü∞)
		   ("last" . ?‚Ü¥)
		   ("while" . ?‚Æç)
		   ("if" . ?‚éß)
		   ("elsif" . ?‚é®)
		   ("else" . ?‚é©)
		   ("int" . ?‚Ñ§)
		   ("keys" . ?ùêä)
		   ("ne" . ?‚â≠)
		   ("eq" . ?‚âç)
		   ("->" . ?‚Üí)
		   ("=>" . ?‚áí)
		   ("=~" .?‚âà)
		   ("!~" . ?‚ââ)
		   ("$self" . ?‚óÜ)))
   (prettify-symbols-mode))
 #+END_SRC

 #+BEGIN_SRC emacs-lisp
 (use-package
   cperl-mode
   :ensure-system-package perltidy
   :after (flycheck tramp)
   :bind (:map cperl-mode-map ())
   :mode ("\\.\\([pP][Llm]\\|al\\)\\'" . cperl-mode)
   :interpreter (("perl"     . cperl-mode)
                 ("perl5"    . cperl-mode)
                 ("miniperl" . cperl-mode))
   :config 
   ;; perl := cperl
   (defalias 'perl-mode 'cperl-mode)
   ;; C-h P –±—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å perldoc –Ω–∞ —Å–ª–æ–≤–æ –ø–æ–¥ –∫—É—Ä—Å–æ—Ä–æ–º
   (define-key 'help-command "P" 'cperl-perldoc-at-point)
   ;; —è –ª—é–±–ª—é smartparens. –ò–∑–≤–∏–Ω–∏, cperl-mode.
   (setq cperl-electric-parens nil)
   ;; –°–∏–º–≤–æ–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
   (add-hook 'cperl-mode-hook 'my-cperl-init-prettify-symbols)
   ;; –û—Ç—Å—Ç—É–ø —Ä–∞–≤–µ–Ω 4, –Ω–µ –≤—ã–ø–µ–Ω–¥—Ä–∏–≤–∞—Ç—å—Å—è!
   (setq cperl-indent-level 4
		 cperl-close-paren-offset -4
		 cperl-continued-statement-offset 4
		 cperl-indent-parens-as-block t
		 cperl-tab-always-indent t)
   ;; –ö—Ä–∞—Å–Ω—ã–µ —Ö—ç—à–∏ –º–µ–Ω—è –≤—Å–µ–≥–¥–∞ —Ä–∞–∑–¥—Ä–∞–∂–∞–ª–∏
   (face-spec-set 'cperl-hash-face '((t :foreground "darkblue"))))
 #+END_SRC

**** –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è Perl —á–µ—Ä–µ–∑ PerlySense

 #+BEGIN_SRC emacs-lisp
 (use-package
   company-plsense
   :hook (cperl-mode . company-mode))
 #+END_SRC

*** Ocaml

 #+BEGIN_SRC emacs-lisp
 (use-package tuareg)
 #+END_SRC

 #+BEGIN_SRC emacs-lisp
 (use-package merlin
   :init
   ;; merlin —Å–∞–º –∏—Ö –Ω–µ –æ–±—ä—è–≤–∏–ª –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –Ω–µ–±–æ–ª—å—à–æ–π –∫–æ—Å—Ç—ã–ª—å
   (use-package iedit)
   (use-package auto-complete)
   :after (tuareg iedit auto-complete)
   :hook ((tuareg-mode . merlin-mode)
          (tuareg-mode . company-mode))
   :config
   (require 'opam-user-setup "~/.emacs.d/opam-user-setup.el"))
 #+END_SRC

 #+BEGIN_SRC emacs-lisp
 (use-package flycheck-ocaml
   :after (flycheck merlin)
   :config
   ;; –æ—à–∏–±–∫–∏ –æ—Ç –º–µ—Ä–ª–∏–Ω–∞ –Ω–∞–º –Ω–µ –Ω—É–∂–Ω—ã, –≤–µ–¥—å —É –Ω–∞—Å –µ—Å—Ç—å flycheck
   (setq merlin-error-after-save nil)
   (flycheck-ocaml-setup))
 #+END_SRC

*** Coq

#+BEGIN_SRC emacs-lisp
(defun my-coq-mode-setup ()
  (company-coq-mode)
  (setq-local company-minimum-prefix-length 1)
  (setq coq-double-hit-enable t)
  (golden-ratio-mode -1)
  (auto-complete-mode -1))

(use-package proof-general
  :mode ("\\.v$" . coq-mode)
  :hook (coq-mode . my-coq-mode-setup))
#+END_SRC

*** Golang

#+BEGIN_SRC emacs-lisp
(defun my-go-mode-setup ()
  (yas-minor-mode)
  (flycheck-mode)
  (add-hook 'before-save-hook 'gofmt-before-save)
  (add-hook 'completion-at-point-functions 'go-complete-at-point)
  (go-guru-hl-identifier-mode)
  (go-eldoc-setup))
#+END_SRC


#+BEGIN_SRC emacs-lisp
(use-package go-mode
  :ensure t
  :mode ("\\.go\\'" . go-mode)
  :config
  (add-hook 'go-mode-hook 'my-go-mode-setup))
#+END_SRC

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

#+BEGIN_SRC emacs-lisp
(use-package go-eldoc
  :ensure t
  :commands (go-eldoc-setup))
#+END_SRC

–ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ

#+BEGIN_SRC emacs-lisp
(use-package company-go
  :defer t
  :init
  (with-eval-after-load 'company
    (add-to-list 'company-backends 'company-go)))
#+END_SRC

–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥

#+BEGIN_SRC emacs-lisp
(use-package go-rename
  :commands (go-rename))
#+END_SRC

–ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤

#+BEGIN_SRC emacs-lisp
(use-package go-guru
  :commands (go-guru-hl-identifier-mode))
#+END_SRC

*** Rust

#+BEGIN_SRC emacs-lisp
(defun my-rust-compile-setup ()
  (set (make-local-variable 'compile-command)
       (if (locate-dominating-file (buffer-file-name) "Cargo.toml")
           "cargo run"
         (format "rustc %s && %s" (buffer-file-name)
                 (file-name-sans-extension (buffer-file-name))))))

(use-package rust-mode
  :after (flycheck tramp racer compile)
  :hook (rust-mode . my-rust-compile-setup)
  :mode ("\\.rs\\'" . rust-mode)
  :bind (:map rust-mode-map
              ("C-c i b" . rust-format-buffer))
  :config
  (add-hook 'rust-mode-hook (lambda () (add-hook 'before-save-hook 'rust-format-buffer nil 'local))))
  ;; (add-hook 'before-save-hook 'rust-format-buffer))
#+END_SRC

**** –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ

#+BEGIN_SRC emacs-lisp
(use-package racer
  :hook (rust-mode . racer-activate)
  :config
  (setq racer-rust-src-path "~/.local/share/rust_src/src"))
#+END_SRC

**** –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –Ω–∞ –ª–µ—Ç—É

#+BEGIN_SRC emacs-lisp
(use-package flycheck-rust
  :after (flycheck)
  :hook (flycheck-mode . flycheck-rust-setup))
#+END_SRC

*** Puppet

#+BEGIN_SRC emacs-lisp
(use-package puppet-mode
  :config
  (setq puppet-indent-level 2)
  (setq puppet-include-indent 2))
#+END_SRC

*** HTML

 –ü–æ–¥–∫–ª—é—á–∞–µ–º web-mode (HTML, JS, CUSS –≤ –æ–¥–Ω–æ–º):

 #+BEGIN_SRC emacs-lisp
 (use-package web-mode
   :mode ("\\.html$" . web-mode)
   :init
   (setq web-mode-markup-indent-offset 4)
   (setq web-mode-code-indent-offset 4)
   (setq web-mode-css-indent-offset 4)
   (setq js-indent-level 4)
   (setq web-mode-enable-auto-pairing t)
   (setq web-mode-enable-auto-expanding t)
   (setq web-mode-enable-css-colorization t))
 #+END_SRC

*** Javascript / ECMA / React

#+BEGIN_SRC emacs-lisp
(use-package tide
  :after (company flycheck)
  :config
  (add-to-list 'company-backends 'company-tide)
  (add-hook 'tide-mode-hook (lambda () (add-hook 'before-save-hook 'tide-format-before-save nil 'local)))
  ;; (add-hook 'before-save-hook 'tide-format-before-save)
  (define-key tide-mode-map (kbd "C-.") 'tide-jump-to-definition)
  (define-key tide-mode-map (kbd "C-,") 'tide-jump-back)
  (flycheck-add-next-checker 'javascript-eslint 'javascript-tide 'append)
  (flycheck-add-next-checker 'javascript-eslint 'jsx-tide 'append)
  (tide-hl-identifier-mode +1))

  (defun my-jsx-setup ()
  (flycheck-mode +1))

(use-package rjsx-mode
  :mode ("\\.js" . rjsx-mode)
  :mode ("\\.jsx" . rjsx-mode)
  :hook (rjsx-mode . tide-setup)
  :hook (rjsx-mode . my-jsx-setup)
  :config
  (setq js-indent-level 2)
  (flycheck-add-mode 'javascript-eslint 'rjsx-mode))
#+END_SRC

*** SQL

#+BEGIN_SRC emacs-lisp
(use-package sql-indent
  :hook (sql-mode . sqlind-minor-mode)
  :commands sqlind-minor-mode)
#+END_SRC

*** –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

 Perltidy.el, –≤–∑—è—Ç–æ –æ—Ç—Å—é–¥–∞: https://www.emacswiki.org/emacs/perltidy.el

 #+BEGIN_SRC emacs-lisp
 (defcustom perltidy-program "perltidy"
   "*Program name of perltidy"
   :type 'string
   :group 'perltidy)

 (defcustom perltidy-program-params
   '(;; I/O control
     "--standard-output"
     "--standard-error-output"
     "--force-read-binary"
     "--quiet"

     ;; FORMATTING OPTIONS
     "--no-check-syntax"
     )
   "*perltidy run options"
   :type 'list
   :group 'perltidy)

 (defcustom perltidy-rcregex "\\.perltidyrc"
   "perltidyrc file regex"
   :type 'string
   :group 'perltidy)

 (defun perltidy-buffer ()
   "Call perltidy for whole buffer."
   (interactive)
   (perltidy-region (point-min) (point-max)))
 ;;;###autoload
 (defun perltidy-region (beg end)
   "Tidy perl code in the region."
   (interactive "r")
   (or (get 'perltidy-program 'has-perltidy)
       (if (executable-find perltidy-program)
           (put 'perltidy-program 'has-perltidy t)
         (error "Seem perltidy is not installed")))
     (let ((old-perltidy-env (getenv "PERLTIDY"))
           (remote? (tramp-tramp-file-p buffer-file-name))
           (perltidyrc (perltidy-find-perltidyrc buffer-file-truename))
           (pertidyrc-remote (expand-file-name "perltidyrc-remote" temporary-file-directory))
           (perltidy-run-list perltidy-program-params)
           )

       (if (and (bound-and-true-p remote?)
                perltidyrc)
           (progn
             (require 'tramp-sh)
             (tramp-sh-handle-copy-file perltidyrc pertidyrc-remote t)
             (setq perltidyrc pertidyrc-remote)
             (setq perltidy-run-list
                   (append perltidy-run-list
                           (list (concat "-pro=" pertidyrc-remote))))))

       (apply #'call-process-region
              (append (list beg end perltidy-program
                            t
                            t
                            nil
                            )
                      perltidy-run-list)))
     t)

 (defun perltidy-subroutine ()
   "Call perltidy for subroutine at point."
   (interactive)

   (save-excursion
     (let ((current-point (point))
           b e)
       (setq b (progn (beginning-of-defun) (point)))
       (when (and
              (looking-at "\\s-*sub\\s-+")
              (< b current-point)
              (> (save-excursion
                   (setq e (progn (end-of-defun) (point))))
                 current-point))
         (perltidy-region b e)))))

 (defun perltidy-find-perltidyrc (&optional dir rcregex)
   (unless dir (setq dir (buffer-file-name)))
   (unless rcregex (setq rcregex perltidy-rcregex))
   (setq dir (file-name-directory dir))

   (let (rcfile)
     (catch 'my-tag
       (locate-dominating-file
        dir
        (lambda (parent)
          (let ((rc (car (ignore-errors (directory-files parent t rcregex))))
                (pparent (file-name-directory (directory-file-name parent))))
            (setq rcfile rc)
            (cond ((equal parent
                          pparent)
                   (if (= (length rc) 0)
                       (throw 'my-tag rc)
                     (throw 'my-tag nil)))

                  ((and (= (length rc) 0)
                        (file-exists-p    (expand-file-name "lib" pparent))
                        (file-directory-p (expand-file-name "lib" pparent)))
                   (setq rcfile (car (ignore-errors (directory-files pparent t rcregex))))
                   (throw 'my-tag rcfile))
                  (t rc))))))
     rcfile))
 #+END_SRC

 Perltidy –¥–ª—è –±—É—Ñ–µ—Ä–∞, —Ç–µ–∫—É—â–µ–π —Ñ—É–Ω–∫—Ü–∏–∏, —Å—Ç—Ä–æ—á–∫–∏ –∏ —Ä–µ–≥–∏–æ–Ω–∞:

 #+BEGIN_SRC emacs-lisp
 (defun perl-mode-perltidy ()
   "Perltidy buffer or region if this is perl file."
   (interactive)
   (let ((saved-line (line-number-at-pos)))
     (save-excursion
       (when (eq major-mode 'cperl-mode)
         (if (use-region-p)
             (perltidy-region (region-beginning) (region-end))
           (perltidy-buffer))))
     (forward-line saved-line)))

 (defun my-perltidy-subroutine ()
   "Perltidy current subroutine keeping current position in the buffer as close as possible"
   (interactive)
   (let ((saved-line (line-number-at-pos)))
     (perltidy-subroutine)
     (goto-line saved-line)))

 (defun my-perl-tab-indent ()
   (interactive)
   (if (use-region-p)
       (perltidy-region (region-beginning) (region-end))
     (cperl-indent-command)))

 (use-package
   cperl-mode
   :after (tramp)
   :bind (:map cperl-mode-map
               ("C-c i d" . my-perltidy-subroutine)
               ("C-c i b" . perl-mode-perltidy)
               ("TAB" . my-perl-tab-indent)))
 #+END_SRC

 –í—Å—Ç–∞–≤–∫–∞ JSON –∏–∑ –±—É—Ñ–µ—Ä–∞ –∫–∞–∫ Perl-—Å—Ç—Ä—É–∫—Ç—É—Ä—ã. –ù–µ —Å–ø—Ä–∞—à–∏–≤–∞–π—Ç–µ, –Ω—É–∂–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã.

 #+BEGIN_SRC emacs-lisp
 (defun my-perl-insert-json ()
   (interactive)
   (shell-command-on-region (point) (point) "xclip -o | json_to_perl.pl" t))

 (use-package
   cperl-mode
   :bind (:map cperl-mode-map
               ("C-c j" . my-perl-insert-json)))
 #+END_SRC

*** –ü–æ–¥—Å–≤–µ—Ç–∫–∞ TODO/FIXME

 #+BEGIN_SRC emacs-lisp
 (use-package fic-mode
   :hook cperl-mode emacs-lisp-mode)
 #+END_SRC

*** –¶–≤–µ—Ç–Ω–æ–π compile buffer

#+BEGIN_SRC emacs-lisp
(defun my-colorize-compilation-buffer ()
  (toggle-read-only)
  (ansi-color-apply-on-region compilation-filter-start (point))
  (toggle-read-only))

(use-package ansi-color
  :hook (compilation-filter . my-colorize-compilation-buffer))
#+END_SRC


** Org-mode
*** –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

 #+BEGIN_SRC emacs-lisp
 (defun my-org-mode-basic-config ()
   ;; –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç–∞—Å–∫–∏ –¥–ª—è—Ç—Å—è 1 —á–∞—Å
   (setq org-agenda-default-appointment-duration 60)
   ;; SRC-–±–ª–æ–∫–∏ –¥–æ–ª–∂–Ω—ã –≤—ã–≥–ª—è–¥–µ—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ –∏—Å—Ö–æ–¥–Ω—ã–µ —Ä–µ–∂–∏–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —ç—Ç–∏—Ö —è–∑—ã–∫–æ–≤
   (setq org-src-fontify-natively t)
   ;; –ö–Ω–æ–ø–∫–∞ tab –≤ SRC-–±–ª–æ–∫–∞—Ö –∏–º–µ–µ—Ç —Ç–æ –∂–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, —á—Ç–æ –∏ –≤ –∏—Å—Ö–æ–¥–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö —è–∑—ã–∫–æ–≤
   (setq org-src-tab-acts-natively t)
   ;; –ù–µ –Ω–∞–¥–æ –Ω–∏–∫—É–¥–∞ —Å–º–µ—â–∞—Ç—å SRC-–±–ª–æ–∫–∏
   (setq org-edit-src-content-indentation 0)
   ;; –†—É–≥–∞—Ç—å—Å—è, –µ—Å–ª–∏ –ø—ã—Ç–∞–µ–º—Å—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–≤–∏–¥–∏–º—ã–π (–Ω–∞–ø—Ä., —Å—Ö–ª–æ–ø–Ω—É—Ç—ã–π) —Ç–µ–∫—Å—Ç
   (setq org-catch-invisible-edits 'error)
   ;; –•–æ—á—É –≤–∏–¥–µ—Ç—å –¥–∞—Ç—É+–≤—Ä–µ–º—è, –∫–æ–≥–¥–∞ –ø—É–Ω–∫—Ç –±—ã–ª –∑–∞–∫—Ä—ã—Ç (CLOSED)
   (setq org-log-done 'time)
   ;; –ó–∞–¥–∞–µ–º –≤–∏–¥—ã —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–ª—è –∑–∞–¥–∞—á
   (setq org-todo-keywords
       '((sequence "TODO(t)" "WAIT(w)" "VERIFY(v)" "DELEGATED(D@)" "|" "DONE(d)" "CANCELED(c@)")))
   ;; –°–ø—Ä—è—Ç–∞—Ç—å –ª–æ–≥ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –≤ LOGGER
   (setq org-log-into-drawer t)
   ;; –†–∞–∑—à–∏—Ç—å refile –≤ –º–æ–∏ org-—Ñ–∞–π–ª—ã, –≤ –ø–æ–¥–¥–µ—Ä–µ–≤—å—è –¥–æ –≥–ª—É–±–∏–Ω—ã 2
   (setq org-refile-targets '((org-agenda-files :maxlevel . 2)))
   ;; –ü—Ä–∏ refile –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–∞–∫–∂–µ –∏–º—è —Ñ–∞–π–ª–∞
   (setq org-refile-use-outline-path 'file)
   ;; –õ—é–±–ª—é –≤—ã–¥–µ–ª—è—Ç—å –ø–æ shift-—Å—Ç—Ä–µ–ª–æ—á–∫–∏, –¥–∞–∂–µ –≤ org-mode
   (setq org-support-shift-select t)

   ;; –£–≥–∞–¥—ã–≤–∞—Ç—å mode SRC-–±–ª–æ–∫–æ–≤ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Ä–µ–∂–∏–º–æ–≤
   (add-to-list 'org-src-lang-modes '("conf" . conf))
   (add-to-list 'org-src-lang-modes '("ini" . conf))
   (add-to-list 'org-src-lang-modes '("vim" . vimrc))

   ;; –ü–æ–¥–∫–ª—é—á–∏—Ç—å —ç—Ç–∏ –º–æ–¥—É–ª–∏
   (add-to-list 'org-modules 'org-id)
   (add-to-list 'org-modules 'org-mouse)
   (add-to-list 'org-modules 'org-attach-screenshot)

   ;; –†–∞–∑—É–∫—Ä–∞—à–∏–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å—ã
   (setq org-todo-keyword-faces
         '(("WAIT" . (:foreground "#ff8040" :weight bold))
           ("VERIFY" . (:foreground "#afaf00" :weight bold))
           ("CANCELED" . (:foreground "#006000" :weight bold))))

   ;; –ü–æ–¥–∫—Ä–∞—Å–∏—Ç—å —Å–ª–æ–≤–∞ TODO –∫—Ä–∞—Å–Ω—ã–º –≤ org-—Ñ–∞–π–ª–∞—Ö
   (face-spec-set 'org-todo '((t :foreground "red")))

   ;; –ú–Ω–µ –Ω–µ –Ω—Ä–∞–≤—è—Ç—Å—è –±–æ–ª—å—à–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ 1-–≥–æ —É—Ä–æ–≤–Ω—è –≤ —Ç–µ–º–µ leuven
   (face-spec-set 'org-level-1 '((t :height 1.1)))

   ;; –ú–Ω–µ –Ω–µ –Ω—Ä–∞–≤—è—Ç—Å—è –±–æ–ª—å—à–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤ #TITLE
   (face-spec-set 'org-document-title '((t :height 1.2)))
 )
 #+END_SRC

*** –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

 #+BEGIN_SRC emacs-lisp
 (require 'org-protocol)

 (use-package
   org
   :ensure nil
   :hook ((org-mode . turn-on-flyspell)
		  ;; –∞–≤—Ç–æ–º–∞—Ç–æ–º —Å—á–∏—Ç—ã–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å –¥–∏—Å–∫–∞
		  (org-mode . turn-on-auto-revert-mode)
		  ;; –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–ª—è org-–±—É—Ñ–µ—Ä–æ–≤
		  (auto-save . org-save-all-org-buffers)
		  ;; –∞–≤—Ç–æ–ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
		  (org-mode . auto-fill-mode))
   :bind (:map my-bindings-map
               ("C-c l" . org-store-link))
   :config
   (my-org-mode-basic-config))
 #+END_SRC

** Org agenda

*** –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

 –ü–µ—Ä–µ—á–∏—Ç–∞—Ç—å –∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã —Å –¥–∏—Å–∫–∞:

 #+BEGIN_SRC emacs-lisp
 (setq my-org-last-reload (current-time))

 (defun my-org-reload-from-disk (&optional event)
   (interactive)
   ;; —Ä–µ–ª–æ–∞–¥–∏—Ç—å –Ω–µ —á–∞—â–µ —Ä–∞–∑–∞ –≤ 3 —Å–µ–∫—É–Ω–¥—ã
   (if (time-less-p (time-add my-org-last-reload 3) (current-time))
	   (progn
		 (setq my-org-last-reload (current-time))
		 (ignore-errors
		   (org-agenda-redo-all)))))
 #+END_SRC

 –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–æ–º, —Å–æ–≥–ª–∞—Å–Ω–æ –º–æ–∏–º –ø—Ä–∞–≤–∏–ª–∞–º. –≠—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –ø–æ –∫—Ä–æ–Ω—É, —á–µ—Ä–µ–∑ run-with-timer.

 #+BEGIN_SRC emacs-lisp
 (defvar my-org-root-path "~/org" "Path to root directory with org files")
 (defvar my-org-files-regexp "[.]org$" "Regexp to match org files")

 (defun my-org-fill-files-list (&optional EXHAUSTIVE)
   (setq org-agenda-files
         (seq-remove
          (lambda (file) (string-match "[.]#" file))
          (directory-files-recursively my-org-root-path my-org-files-regexp)))
   ;; –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è —Å–ø–∏—Å–∫–æ–≤ —Ñ–∞–π–ª–æ–≤, –Ω–µ–ø–ª–æ—Ö–æ –±—ã –ø–µ—Ä–µ—á–∏—Ç–∞—Ç—å –∏—Ö —Å –¥–∏—Å–∫–∞
   (my-org-reload-from-disk))
   ;; (my-org-fill-inotify-handlers))
 #+END_SRC

 –û–±–Ω–æ–≤–∏—Ç—å –±—É—Ñ–µ—Ä –∞–≥–µ–Ω–¥—ã:

 #+BEGIN_SRC emacs-lisp
 (defun my-org-agenda-redo ()
   (ignore-errors
     (with-current-buffer "*Org Agenda*"
       (org-agenda-maybe-redo))))
 #+END_SRC

*** –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ agenda

 #+BEGIN_SRC emacs-lisp
 (defun my-agenda-mode-setup ()
   (hl-line-mode))

 (defun my-org-agenda-basic-config ()
   ;; –î–Ω–∏ —Ä–æ–∂–¥–µ–Ω–Ω–∏—è –≤ BBDB –±—Ä–∞—Ç—å –∏–∑ –ø–æ–ª—è birthday
   (setq org-bbdb-anniversary-field 'birthday)
   ;; –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å DONE –≤ –∞–≥–µ–Ω–¥–µ
   (setq org-agenda-skip-scheduled-if-done 't)

   ;; –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ —Ç–µ–º–µ leuven –º–Ω–µ –≤ —ç—Ç–æ–º –º–µ—Å—Ç–µ –Ω–µ –Ω—Ä–∞–≤—è—Ç—Å—è
   (face-spec-set 'org-agenda-structure '((t :height 1.17)))
   (face-spec-set 'org-agenda-date-today '((t :height 1.1)))
   (face-spec-set 'org-agenda-date '((t :height 1.1)))
   (face-spec-set 'org-agenda-date-weekend '((t :height 1.1))))
 #+END_SRC

*** –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ —Ç–∞—Å–∫–∏

 –ò–Ω–æ–≥–¥–∞ —Ö–æ—á–µ—Ç—Å—è —Å–ø—Ä—è—Ç–∞—Ç—å —Ç–∞—Å–∫ –∏–∑ –∞–≥–µ–Ω–¥—ã –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è, —á—Ç–æ–±—ã –≥–ª–∞–∑–∞ –µ–≥–æ –º–æ–∏ –Ω–µ –≤–∏–¥–µ–ª–∏.

 –í–µ—à–∞–µ–º –≤ agenda-–±—É—Ñ–µ—Ä–µ –Ω–∞ –∫–Ω–æ–ø–∫—É C-d —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –æ—Ç–∫–ª–∞–¥—ã–≤–∞–Ω–∏—è —Ç–∞—Å–∫–∞:

 #+BEGIN_SRC emacs-lisp
 (defun my-agenda-delayed-tasks-setup ()
   (defun my-org-agenda-delay-task ()
     (interactive)
     (org-agenda-check-no-diary)
     (let* ((hdmarker (or (org-get-at-bol 'org-hd-marker)
                          (org-agenda-error)))
            (buffer (marker-buffer hdmarker))
            (pos (marker-position hdmarker))
            (inhibit-read-only t)
            newhead)
       (org-with-remote-undo buffer
         (with-current-buffer buffer
           (widen)
           (goto-char pos)
           (org-show-context 'agenda)
           (let ((delay (org-read-date 't 'nil 'nil "–û—Ç–ª–æ–∂–∏—Ç—å –¥–æ" 'nil
                                       (format-time-string "%H:%M" (time-add (current-time) 3600)))))
             (org-set-property "DELAYED_TILL" delay))))
       (org-agenda-redo-all)))
   (defun my-org-agenda-delay-task-setup-hook ()
     (local-set-key (kbd "\C-c d") 'my-org-agenda-delay-task))
   (add-hook 'org-agenda-mode-hook 'my-org-agenda-delay-task-setup-hook)
 )
 #+END_SRC

 –§—É–Ω–∫—Ü–∏—è, —Ä–µ–∞–ª–∏–∑—É—é—â–∞—è –ø—Ä–æ–ø—É—Å–∫ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ç–∞—Å–∫–æ–≤ –≤ agenda-–±—É—Ñ–µ—Ä–µ:

 #+BEGIN_SRC emacs-lisp
 (defun my-org-agenda-skip-delayed ()
   (let ((now (format-time-string "%Y-%m-%d %H:%M" (time-add (current-time) 120)))
         (delayed-till (org-read-date t nil (or (org-entry-get nil "DELAYED_TILL") "") nil))
         (subtree-end (save-excursion (org-end-of-subtree t))))
       (if (string> delayed-till now) subtree-end nil)))

 #+END_SRC

*** –ì–æ—Ä—è—á–∏–µ –∫–Ω–æ–ø–∫–∏

 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥ agenda:

 #+BEGIN_SRC emacs-lisp
 (defun my-org-agenda-commands-config ()
   (setq org-agenda-custom-commands
       '(("d" . "–°–µ–≥–æ–¥–Ω—è")
         ("dd" agenda "–°–µ–≥–æ–¥–Ω—è, –≤—Å–µ –∑–∞–ø–∏—Å–∏"
          ((org-agenda-span 'day)
           (org-agenda-overriding-header "–°–µ–≥–æ–¥–Ω—è, –≤—Å–µ –∑–∞–ø–∏—Å–∏")))
         ("da" agenda "–°–µ–≥–æ–¥–Ω—è, –±–µ–∑ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö"
          ((org-agenda-span 'day)
           (org-agenda-skip-function 'my-org-agenda-skip-delayed)
           (org-agenda-overriding-header "–°–µ–≥–æ–¥–Ω—è, —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ"))))))
 #+END_SRC

*** –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

 #+BEGIN_SRC emacs-lisp
 (use-package
     org-agenda
     :ensure nil
     :after (org org-element)
	 :hook (org-agenda-mode . my-agenda-mode-setup)
	 :bind (:map my-bindings-map
				 ("C-c a" . org-agenda))
	 :config
	 (my-org-agenda-basic-config)
	 (my-agenda-delayed-tasks-setup)
	 (my-org-agenda-commands-config)
	 (my-org-fill-files-list)
	 ;; —Ä–∞–∑ –≤ 10 –º–∏–Ω—É—Ç –∑–∞–Ω–æ–≤–æ —Å–æ—Å—Ç–∞–≤–ª—è—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤, –Ω–∞ —Å–ª—É—á–∞–π –ø–æ—è–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö
	 (run-with-timer 0 600 'my-org-fill-files-list)
	 ;; 
	 (run-with-idle-timer 120 120 'my-org-agenda-redo)
	 (my-load-org-config "local/org-agenda.org"))
 #+END_SRC

*** –ü—Ä–æ—á–µ–µ

 –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –≤—ã—Ö–æ–¥–æ–º:

 #+BEGIN_SRC emacs-lisp
 (advice-add 'org-agenda-quit :before 'org-save-all-org-buffers)
 #+END_SRC

**** –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö DONE —Ç–∞—Å–∫–æ–≤ –≤ —Ç–µ–∫—É—â–µ–º –±—É—Ñ–µ—Ä–µ

 #+BEGIN_SRC emacs-lisp
 (defun my-org-archive-done-tasks ()
   "Archive all DONE tasks in current buffer"
   (interactive)
   (org-map-entries
    (lambda ()
      (org-archive-subtree)
      (setq org-map-continue-from (outline-previous-heading)))
    "/DONE" 'file))
 #+END_SRC

**** –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π heading —Å–æ –≤—Å–µ–º–∏ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏, —Å–æ —Å–¥–≤–∏–≥–æ–º –≤—Å–µ—Ö –¥–∞—Ç –≤–Ω—É—Ç–∏

 #+BEGIN_SRC emacs-lisp
 (defun my-org-clone-to-date ()
   "Clone current subtree into specified file with all dates shifted to the same period."
   (interactive)
   (let* ((title (nth 4 (org-heading-components)))
          (orig-date (org-time-string-to-absolute (org-entry-get nil "SCHEDULED")))
          (dest-date (org-time-string-to-absolute
                      (org-read-date nil nil nil (format "–î–∞—Ç–∞ –¥–ª—è '%s'" title))))
          (offset (format "+%id" (- dest-date orig-date))))
     (org-copy-subtree)
     (with-temp-buffer
       (org-mode)
       (org-paste-subtree)
       (org-clone-subtree-with-time-shift 1 offset)
       (org-forward-element)
       (org-refile))))
 #+END_SRC

** Org export

*** Confluence

#+BEGIN_SRC emacs-lisp
(use-package
  org
  :defer t
  :config
  (require 'ox-confluence))
#+END_SRC

*** LaTeX

 #+BEGIN_SRC emacs-lisp
 (use-package
   org
   :defer t
   :config
   ;; –ö–∞–∫–∏–µ \usepackage –ø—Ä–æ–ø–∏—Å—ã–≤–∞—Ç—å –≤ LaTeX –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
   (setq org-latex-default-packages-alist
         '(("utf8" "inputenc" t ("pdflatex"))
           ("T2A" "fontenc" t ("pdflatex"))
           ("russian" "babel" t)
           ("" "cmap" t)
           ("" "graphicx" t)
           ("" "grffile" t)
           ("" "longtable" nil)
           ("" "wrapfig" nil)
           ("" "rotating" nil)
           ("normalem" "ulem" t)
           ("" "amsmath" t)
           ("" "textcomp" t)
           ("" "tabularx" t)
           ("" "amssymb" t)
           ("" "capt-of" nil)
           ("" "hyperref" nil)))
   ;; –§–∞–π–ª—ã —Å —ç—Ç–∏–º–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏ —Å—á–∏—Ç–∞—é—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã
   (setq org-latex-logfiles-extensions
         '("aux" "bcf" "blg" "fdb_latexmk" "fls" "figlist" "idx" "log" "nav" "out" "ptc" "run.xml" "snm" "toc" "vrb" "xdv" "tex")))
 #+END_SRC

*** Hugo

**** –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

 #+BEGIN_SRC emacs-lisp
 (use-package
   ox-hugo
   :after (ox org)
   :hook ((org-export-before-processing . my-org-hugo-add-printable-version)
          (org-export-before-processing . my-org-hugo-add-source-of-article))
   :config
   (setq org-hugo-external-file-extensions-allowed-for-copying
         '("jpg" "jpeg" "tiff" "png" "svg" "gif" "pdf" "odt" "doc" "ppt" "xls" "docx" "pptx" "xlsx" "sorg"))
   (remove-hook 'org-export-before-parsing-hook 'my-org-hugo-add-printable-version))
 #+END_SRC

**** –§–∏—á–∞: —Å—Å—ã–ª–∫–∞ –Ω–∞ –≤–µ—Ä—Å–∏—é –¥–ª—è –ø–µ—á–∞—Ç–∏

 #+BEGIN_SRC emacs-lisp
 (defun my-org-hugo-add-printable-version (backend)
   (if (eq backend 'hugo)
       (let ((generate-printable (org-entry-get nil "HUGO_GENERATE_PRINTABLE"))
             (file-org-name (buffer-file-name))
             (file-pdf-name (concat (file-name-sans-extension (buffer-file-name)) ".pdf")))
         (if (and generate-printable (string= generate-printable "t"))
             (if (file-newer-than-file-p file-org-name file-pdf-name)
                 (progn
                   (org-latex-export-to-pdf)
                   (find-file file-org-name)
                   (if (not (org-entry-get nil "HUGO_GENERATE_PRINTABLE_ADDED"))
                       (progn
                         (save-excursion
                           (goto-char (point-max))
                           (insert (format "\n** –í–µ—Ä—Å–∏—è –¥–ª—è –ø–µ—á–∞—Ç–∏\n\n–î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ –ø–µ—á–∞—Ç–∏ –º–æ–∂–Ω–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è [[file:%s][PDF]]-–≤–µ—Ä—Å–∏–µ–π —ç—Ç–æ–π —Å—Ç–∞—Ç—å–∏." (file-name-nondirectory file-pdf-name))))
                         (org-set-property "HUGO_GENERATE_PRINTABLE_ADDED" "t")
                         (save-buffer)))))))))

 (use-package
   ox-hugo
   :after (ox org)
   :hook (org-export-before-processing . my-org-hugo-add-printable-version)
   :config
   (remove-hook 'org-export-before-parsing-hook 'my-org-hugo-add-printable-version))
 #+END_SRC

**** –§–∏—á–∞: —Å—Å—ã–ª–∫–∞ –Ω–∞ –∏—Å—Ö–æ–¥–Ω–∏–∫ —Å—Ç–∞—Ç—å–∏

 #+BEGIN_SRC emacs-lisp
 (defun my-org-hugo-add-source-of-article (backend)
   (if (eq backend 'hugo)
       (let* ((generate-printable (org-entry-get nil "HUGO_ADD_ARTICLE_SOURCE"))
             (file-org-name (buffer-file-name))
             (file-org-shortname (file-name-nondirectory file-org-name)))
         (if (and generate-printable (string= generate-printable "t"))
             (progn
               (find-file file-org-name)
               (if (not (org-entry-get nil "HUGO_ADD_ARTICLE_SOURCE_ADDED"))
                   (progn
                     (save-excursion
                       (goto-char (point-max))
                       (insert (format "\n** –ò—Å—Ö–æ–¥–Ω–∏–∫ —Å—Ç–∞—Ç—å–∏\n\n–°—Å—ã–ª–∫–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è: [[file:%s][%s]]."
                                       file-org-shortname
                                       file-org-shortname)))
                         (org-set-property "HUGO_ADD_ARTICLE_SOURCE_ADDED" "t")
                         (save-buffer))))))))

 (use-package
   ox-hugo
   :after (ox org)
   :hook (org-export-before-processing . my-org-hugo-add-printable-version))
 #+END_SRC

**** –§–∏—á–∞: —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–Ω–æ—Å–æ–≤

 –ò—Å–ø–æ–ª—å–∑—É—é –≤–Ω–µ—à–Ω–∏–π —Å–∫—Ä–∏–ø—Ç–∏–∫, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏, –∫–æ—Ç–æ—Ä—É—é –æ–±—É—á–∏–ª –ø–µ—Ä–µ–Ω–æ—Å–∞–º. https://github.com/johnlepikhin/p5-AI-Hyphen

 #+BEGIN_SRC emacs-lisp
 (defun my-hyphenize-russian (input hyphen)
   (interactive)
   (with-temp-buffer
     (progn
       (insert input)
       (call-process-region (point-min) (point-max) "~/bin/hyphen/russian/russian-hyphen.pl" t t nil "--hyphenize-stdin" (concat "--hyphen-char=" hyphen))
       (buffer-string))))

 (defun my-hugo-improvements (text backend info)
   (when (org-export-derived-backend-p backend 'hugo)
     (my-hyphenize-russian text "&#173;")))

 (use-package
   ox-hugo
   :after (ox org)
   :config
   (add-to-list 'org-export-filter-plain-text-functions
                'my-hugo-improvements))
 #+END_SRC

**** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —ç–∫—Å–ø–æ—Ä—Ç (batch mode)

 #+BEGIN_SRC emacs-lisp
 (defvar my-org-blog-path "~/org/personal" "Root path where to find blog articles")

 (defun my-org-hugo-export-file (f)
   (interactive)
   (save-excursion
     (message (concat "Processing file " f))
     (find-file f)
     (my-org-hugo-twits-prepare f)
     (save-buffer)
     (org-hugo-export-wim-to-md :all-subtrees nil nil t)
     (kill-buffer (current-buffer))))

 (defun my-org-hugo-export-files-org-personal (&key newer-than)
   (interactive)
   (save-excursion
     (let ((newer-than (seconds-to-time (if (null newer-than) 0 newer-than))))
       (mapc 'my-org-hugo-export-file
             (seq-filter
              (lambda (file)
                (and
                 (not (string-match "/[.]#" file))
                 (time-less-p newer-than (nth 5 (file-attributes file)))))
              (directory-files-recursively my-org-blog-path "\\.s?org$"))))))

 #+END_SRC

**** –≠–∫—Å–ø–æ—Ä—Ç embedded –≤–∏–¥–µ–æ –≤ Hugo. –ù–µ —Å–ø—Ä–∞—à–∏–≤–∞–π—Ç–µ.

 #+BEGIN_SRC emacs-lisp
 (defun org-image-update-overlay (file link &optional data-p refresh)
   "Create image overlay for FILE associtated with org-element LINK.
         If DATA-P is non-nil FILE is not a file name but a string with the image data.
         See also `create-image'.
         This function is almost a duplicate of a part of `org-display-inline-images'."
   (when (or data-p (file-exists-p file))
     (let ((width
            ;; Apply `org-image-actual-width' specifications.
            (cond
             ((not (image-type-available-p 'imagemagick)) nil)
             ((eq org-image-actual-width t) nil)
             ((listp org-image-actual-width)
              (or
               ;; First try to find a width among
               ;; attributes associated to the paragraph
               ;; containing link.
               (let ((paragraph
                      (let ((e link))
                        (while (and (setq e (org-element-property
                                             :parent e))
                                    (not (eq (org-element-type e)
                                             'paragraph))))
                        e)))
                 (when paragraph
                   (save-excursion
                     (goto-char (org-element-property :begin paragraph))
                     (when
                         (re-search-forward
                          "^[ \t]*#\\+attr_.*?: +.*?:width +\\(\\S-+\\)"
                          (org-element-property
                           :post-affiliated paragraph)
                          t)
                       (string-to-number (match-string 1))))))
               ;; Otherwise, fall-back to provided number.
               (car org-image-actual-width)))
             ((numberp org-image-actual-width)
              org-image-actual-width)))
           (old (get-char-property-and-overlay
                 (org-element-property :begin link)
                 'org-image-overlay)))
       (if (and (car-safe old) refresh)
           (image-refresh (overlay-get (cdr old) 'display))
         (let ((image (create-image file
                                    (and width 'imagemagick)
                                    data-p
                                    :width width)))
           (when image
             (let* ((link
                     ;; If inline image is the description
                     ;; of another link, be sure to
                     ;; consider the latter as the one to
                     ;; apply the overlay on.
                     (let ((parent
                            (org-element-property :parent link)))
                       (if (eq (org-element-type parent) 'link)
                           parent
                         link)))
                    (ov (make-overlay
                         (org-element-property :begin link)
                         (progn
                           (goto-char
                            (org-element-property :end link))
                           (skip-chars-backward " \t")
                           (point)))))
               (overlay-put ov 'display image)
               (overlay-put ov 'face 'default)
               (overlay-put ov 'org-image-overlay t)
               (overlay-put
                ov 'modification-hooks
                (list 'org-display-inline-remove-overlay))
               (push ov org-inline-image-overlays))))))))

 ;; youtube

 (defvar yt-iframe-format
   (concat "<div class=\"yt-container\"><iframe src=\"https://www.youtube.com/embed/%s\""
           " frameborder=\"0\""
           " allowfullscreen>%s</iframe></div>"))

 (defvar yt-hugo-format "{{< youtube id=\"%s\" >}}")

 (org-link-set-parameters
  "yt"
  :follow (lambda (handle)
            (browse-url
             (concat "https://www.youtube.com/embed/"
                     handle)))
  :export (lambda (path desc backend)
            (cl-case backend
              (md (format yt-hugo-format path))
              (html (format yt-iframe-format path (or desc "")))
              (latex (format "\href{%s}{%s}"
                             path (or desc "video"))))))

 (defun org-yt-get-image (url)
   "Retrieve image from url."
   (let ((image-buf (url-retrieve-synchronously url)))
     (when image-buf
       (with-current-buffer image-buf
         (goto-char (point-min))
         (when (looking-at "HTTP/")
           (delete-region (point-min)
                          (progn (re-search-forward "\n[\n]+")
                                 (point))))
         (setq image-data (buffer-substring-no-properties (point-min) (point-max)))))))

 (defconst org-yt-video-id-regexp "[-_[:alnum:]]\\{10\\}[AEIMQUYcgkosw048]"
   "Regexp matching youtube video id's taken from `https://webapps.stackexchange.com/questions/54443/format-for-id-of-youtube-video'.")

 (defun org-yt-display-inline-images (&optional include-linked refresh beg end)
   "Like `org-display-inline-images' but for yt-links."
   (when (display-graphic-p)
     (org-with-wide-buffer
      (goto-char (or beg (point-min)))
      (let ((re (format "\\[\\[%s:\\(%s\\)\\]\\]" "yt" org-yt-video-id-regexp)))
        (while (re-search-forward re end t)
          (let ((video-id (match-string 1))
                (el (save-excursion (goto-char (match-beginning 1)) (org-element-context)))
                image-data)
            (when el
              (setq image-data 
                    (or (let ((old (get-char-property-and-overlay
                                    (org-element-property :begin el)
                                    'org-image-overlay)))
                          (and old
                               (car-safe old)
                               (overlay-get (cdr old) 'display)))
                        (org-yt-get-image (format "http://img.youtube.com/vi/%s/0.jpg" video-id))))
              (when image-data
                (org-image-update-overlay image-data el t t)))))))))

 (use-package
   org
   :ensure nil
   :config (advice-add #'org-display-inline-images :after #'org-yt-display-inline-images))
 #+END_SRC

*** Mind map

#+BEGIN_SRC emacs-lisp
(use-package org-mind-map
  :init
  (require 'ox-org)
  :ensure t
  :config
  ;; –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö–æ—á—É –ø–æ–ª—É—á–∞—Ç—å –º–∞–ª–µ–Ω—å–∫–∏–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏. –£ –º–µ–Ω—è –±–æ–ª—å—à–æ–π –º–æ–∑–≥ –∏ –æ–Ω –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –±–æ–ª—å—à–∏–µ –∫–∞—Ä—Ç—ã
  (setq org-mind-map-default-graph-attribs '()))
#+END_SRC

** Org babel (–∏—Å–ø–æ–ª–Ω—è–µ–º—ã–µ –∫—É—Å–æ—á–∫–∏ –∫–æ–¥–∞ –≤ org-—Ñ–∞–π–ª–∞—Ö)

 Org babel —Ä–µ–∂–∏–º—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–¥–æ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å

 #+BEGIN_SRC emacs-lisp
 (defun my-org-confirm-babel-evaluate (lang body)
   (not (or
         (string= lang "latex")
         (string= lang "dot")
         (string= lang "graphviz")
         (string= lang "gnuplot")
         (string= lang "plantuml"))))

 (use-package
   org-babel
   :ensure nil
   :after
   (org ob-ruby ob-perl ob-shell ob-sql ob-plantuml ob-gnuplot ob-coq ob-python ob-ocaml ob-http)
   :config
   ;; –ù–µ –ø—Ä–æ—Å–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ SRC-–±–ª–æ–∫–æ–≤
   (setq org-confirm-babel-evaluate 'my-org-confirm-babel-evaluate)
   ;; –ó–∞–≥—Ä—É–∑–∏—Ç—å —è–∑—ã–∫–∏
   (org-babel-do-load-languages
    'org-babel-load-languages
    '((perl . t)
      (ruby . t)
      (shell . t)
      (latex . t)
      (org . t)
      (dot . t)
      (http . t)
      (sql . t)
      (coq . t)
      (ocaml . t)
      (plantuml . t)
      (gnuplot 't)
      (emacs-lisp . t))))
 #+END_SRC

** Org capture (—à–∞–±–ª–æ–Ω—ã –∑–∞–ø–∏—Å–µ–π)

 #+BEGIN_SRC emacs-lisp
 (defvar my-org-file-main-inbox "~/org/personal/general-TODO.org" "–ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –∏–Ω–±–æ–∫—Å–∞ –∑–∞–¥–∞—á")
 (defvar my-org-file-web-bookmarks "~/org/personal/web-bookmarks.org" "–ü—É—Ç—å –¥–æ —Ñ–∞–π–ª–∞, –≥–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤–µ–±-–∑–∞–∫–ª–∞–¥–∫–∏")

 (use-package
   org-capture
   :ensure nil
   :after (org)
   :bind (:map my-bindings-map
               ("C-c c" . org-capture))
   :config
   ;; –ì–ª–∞–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏
   (add-to-list
    'org-capture-templates
    '("g" "–û–±—â–∏–π TODO" entry (file my-org-file-main-inbox)
      "* TODO %?\nSCHEDULED: %t"))
   ;; –ó–∞–º–µ—Ç–∫–∏ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞ —Ç–æ–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –≥–ª–∞–≤–Ω—ã–π –∏–Ω–±–æ–∫—Å
   (add-to-list
    'org-capture-templates
    '("Pm" "(Protocol bookmark)" entry (file+headline my-org-file-main-inbox "–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞")
      "* TODO –í–∑—è—Ç–æ –∏–∑ –≤–µ–±–∞: [[%:link][%:description]]\n  SCHEDULED: %^T\n\n–î–æ–±–∞–≤–ª–µ–Ω–æ: %U\n\n#+BEGIN_QUOTE\n%i\n#+END_QUOTE\n\n%?"))
   ;; –ó–∞–∫–ª–∞–¥–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞ —Ö—Ä–∞–Ω–∏–º –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º org-—Ñ–∞–π–ª–µ, –≤ –¥–µ—Ä–µ–≤–µ –≥–æ–¥–æ–≤/–º–µ—Å—è—Ü–µ–≤/–¥–∞—Ç
   (add-to-list
    'org-capture-templates
    '("Pb" "(Protocol bookmark)" entry (file+olp+datetree my-org-file-web-bookmarks)
      "* –ó–∞–∫–ª–∞–¥–∫–∞ %U : [[%:link][%:description]]\n%?\n"))
   ;; –ü–æ–¥–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ö–æ—Å—Ç–∞
   (my-load-org-config "local/org-capture.org"))
 #+END_SRC

*** –°—É–ø–µ—Ä-—à–∞–±–ª–æ–Ω—ã

 Refile –≤—Å–µ–≥–æ –ø–æ–¥–¥–µ—Ä–µ–≤–∞ –ø–æ–¥ –∫—É—Ä—Å–æ—Ä–æ–º —Å –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–æ–π –¥–∞—Ç –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–º—É —Å–º–µ—â–µ–Ω–∏—é. –î–ª—è –∫–æ—Ä–Ω–µ–≤–æ–≥–æ –ø–æ–¥–¥–µ—Ä–µ–≤–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–¥–∞–Ω–æ SCHEDULED.

 #+BEGIN_SRC emacs-lisp
 (defun my-org-clone-to-date ()
   "Clone current subtree into specified file with all dates shifted to the same period."
   (interactive)
   (let* ((title (nth 4 (org-heading-components)))
          (orig-date (org-time-string-to-absolute (org-entry-get nil "SCHEDULED")))
          (dest-date (org-time-string-to-absolute
                      (org-read-date nil nil nil (format "–î–∞—Ç–∞ –¥–ª—è '%s'" title))))
          (offset (format "+%id" (- dest-date orig-date))))
     (org-copy-subtree)
     (with-temp-buffer
       (org-mode)
       (org-paste-subtree)
       (org-clone-subtree-with-time-shift 1 offset)
       (org-forward-element)
       (org-refile))))
 #+END_SRC

**** –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑—É—é

 –£ –º–µ–Ω—è –µ—Å—Ç—å —à–∞–±–ª–æ–Ω—ã –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π, –≥–¥–µ –æ–ø–∏—Å–∞–Ω–∞ –≤—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–¥–æ —Å–æ–≤–µ—Ä—à–∏—Ç—å –ø—Ä–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ. –í –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ —É–∫–∞–∑–∞–Ω
 SCHEDULED, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π, –∫–æ–≥–¥–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –¥–æ–ª–∂–Ω–æ —Å–æ—Å—Ç–æ—è—Ç—å—Å—è. –ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –≤–Ω—É—Ç—Ä–∏ –∫–æ—Ä–Ω–µ–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–æ–ø–∏—è –≤—Å–µ–π
 —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π —Ñ–∞–π–ª —Å–æ —Å–º–µ—â–µ–Ω–∏–µ–º –¥–∞—Ç –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑–∞–Ω–Ω–æ–π. –ù–∞–ø—Ä–∏–º–µ—Ä:

 #+BEGIN_SRC org
 ,* –°–ª—ë—Ç –°–ø–ª–∞–≤–∞ [0%]                                                    :–°–ø–ª–∞–≤:
   DEADLINE: <2019-05-25 –°–± -3d> SCHEDULED: <2019-05-25 –°–±>
   :PROPERTIES:
   :COOKIE_DATA: todo recursive
   :END:

 –ï—Ö–∞—Ç—å –¥–æ —Å—Ç–∞–Ω—Ü–∏–∏ –ü–æ–¥–æ—Å–∏–Ω–∫–∏ —Å –ö–∞–∑–∞–Ω—Å–∫–æ–≥–æ –≤–æ–∫–∑–∞–ª–∞
 –≠–ª–µ–∫—Ç—Ä–∏—á–∫–∞ –æ—Ç—Ö–æ–¥–∏—Ç –≤ ..., —Å—Ç–æ–∏—Ç ... —Ä—É–±

 –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∞–≤—Ç–æ–±—É—Å–æ–≤ –æ—Ç –ü–æ–¥–æ—Å–∏–Ω–æ–∫: ...

 –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∞–≤—Ç–æ–±—É—Å–æ–≤ –æ—Ç –ª–∞–≥–µ—Ä—è: ...

 ,** TODO –°–ø–∏—Å–æ–∫ –≤–µ—â–µ–π
    SCHEDULED: <2019-05-22 –°—Ä>

 2 –±–∞–ª–ª–æ–Ω–∞ –≥–∞–∑–∞
 –ü—Ä–æ–¥—É–∫—Ç—ã
 –£—Å—ã
 –ö–∞—Å–∫–∞
 ...

 ,** TODO –£–∑–Ω–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —ç–ª–µ–∫—Ç—Ä–∏—á–µ–∫, –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å
    SCHEDULED: <2019-05-22 –°—Ä>
 ,** TODO –£–∑–Ω–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∞–≤—Ç–æ–±—É—Å–æ–≤ –≤ [[https://vk.com/splavclub][–≥—Ä—É–ø–ø–µ]].
    SCHEDULED: <2019-05-22 –°—Ä>
 ,** TODO –ö–∞—Ä—Ç–∞ –Ω–∞ GPS
    SCHEDULED: <2019-05-21 –í—Ç>

 –í –∞—Ä—Ö–∏–≤–µ –∫–∞—Ä—Ç –Ω–∞ GPS –ª–µ–∂–∏—Ç splav.img

 ,** TODO –°–Ω—è—Ç—å –¥–µ–Ω—å–≥–∏
    SCHEDULED: <2019-05-23 –ß—Ç>

 ,** TODO –ü—Ä–æ–¥—É–º–∞—Ç—å —Ä–∞—Å–∫–ª–∞–¥–∫—É –ø–æ –µ–¥–µ
    SCHEDULED: <2019-05-21 –í—Ç>

 #+END_SRC

 *–í–∞–∂–Ω–æ*: —Ñ–∏—á–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫–∏—Ü—é ~org-clone-subtree-with-time-shift~, –∏ –æ–Ω–∞ —Å–ª–∏—à–∫–æ–º —É–º–Ω–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç repeated tasks. –ü–æ—ç—Ç–æ–º—É –µ—Å–ª–∏
 –≤ –ø–ª–∞–Ω–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫–∞–∫–æ–π-—Ç–æ —Ç–∞—Å–∫ –Ω–∞–¥–æ –ø–æ–≤—Ç–æ—Ä—è—Ç—å (–ø—Ä–∏–º–µ—Ä: –ø–µ—Ä–µ–¥ –ø–æ–µ–∑–¥–∫–æ–π –≤ –≥–æ—Ä—ã —Ç—Ä–∏–∂–¥—ã –≤ –Ω–µ–¥–µ–ª—é –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –±–µ–≥), —Ç–æ —Ç–∞—Å–∫ –Ω–∞–¥–æ
 —Ä–∞—Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é, –∑–∞—Ä–∞–Ω–µ–µ —Ä–∞—Å—Å—Ç–∞–≤–∏–≤ –¥–∞—Ç—ã —Å–æ —Å–º–µ—â–µ–Ω–∏–µ–º.

** –ü—Ä–æ—á–∏–µ Org-—Ñ–∏—á–∏

*** –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–∞—Ä–æ–ª–µ–π

 #+BEGIN_SRC emacs-lisp
 (use-package
   org-password-manager
   :after (org)
   :hook (org-mode . org-password-manager-key-bindings))
 #+END_SRC

*** –¢–∞–±–ª–∏—Ü—ã

 –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ org-—Ñ–∞–π–ª–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–æ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã –≤ –Ω—ë–º:

 #+BEGIN_SRC emacs-lisp
 (defun my-org-mode-on-save-buffer-setup ()
   (add-hook 'before-save-hook #'org-table-iterate-buffer-tables nil 'make-it-local))

 (use-package
   org-table
   :ensure nil
   :after (org)
   :hook (org-mode . my-org-mode-on-save-buffer-setup))
 #+END_SRC

*** –ó–∞–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –≤ –±—É—Ñ–µ—Ä–µ

 #+BEGIN_SRC emacs-lisp
 (defun my-org-archive-done-tasks ()
   "Archive all DONE tasks in current buffer"
   (interactive)
   (org-map-entries
    (lambda ()
      (org-archive-subtree)
      (setq org-map-continue-from (outline-previous-heading)))
    "/DONE" 'file))
 #+END_SRC

** Spell-checking

 #+BEGIN_SRC emacs-lisp
 (use-package
   flyspell
  ;  :ensure-system-package (ispell aspell-en aspell-ru)
   :hook ((text-mode . turn-on-flyspell)
          (prog-mode . flyspell-prog-mode))
   :commands (flyspell-buffer turn-on-flyspell)
   :config
   ;; –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —è–∑—ã–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—é —Ä–∞—Å–∫–ª–∞–¥–∫–∏
   (defadvice my-select-input-eng (after ispell-american activate) (ispell-change-dictionary "american"))
   (defadvice my-select-input-rus (after ispell-russian activate) (ispell-change-dictionary "russian")))
 #+END_SRC

 –í–∫–ª—é—á–∞–µ–º –ª–µ–Ω–∏–≤—É—é –ø—Ä–æ–≤–µ—Ä–∫—É, –∫–æ–≥–¥–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

 #+BEGIN_SRC emacs-lisp
 (use-package
   flyspell-lazy
   :config
   (setq flyspell-lazy-idle-seconds 1)
   ;; –ü—Ä–æ–≤–µ—Ä—è—Ç—å –≤—Å–µ –±—É—Ñ–µ—Ä—ã, –≤–∫–ª—é—á–∞—è –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∏–ø–∞ *scratch* –∏ –±—É—Ñ–µ—Ä–æ–≤ Gnus
   (setq flyspell-lazy-disallow-buffers nil)   (flyspell-lazy-mode 1))
 #+END_SRC
** Helm

 #+BEGIN_SRC emacs-lisp
 (use-package helm-org-rifle)
 #+END_SRC

 #+BEGIN_SRC emacs-lisp
 (use-package
   helm
   :after (helm-org-rifle recentf)
   :bind (:map my-bindings-map
               ("M-s M-s" . my-helm-search-all))
   :preface
   (defvar my-helm-sources)
   ;; –§—É–Ω–∫—Ü–∏—è –∏—â–µ—Ç –ø–æ –≤—Å–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º
   (defun my-helm-search-all ()
	 (interactive)
	 (let ((sources (append (helm-org-rifle-get-sources-for-open-buffers) my-helm-sources)))
	   (unless helm-source-buffers-list
		 (setq helm-source-buffers-list
			   (helm-make-source "Buffers" 'helm-source-buffers)))
	   (helm :sources sources
			 :buffer "*helm completions*")))
   :config
   (require 'helm-for-files)
   (require 'helm-elisp)
   (setq helm-split-window-in-side-p t
         helm-M-x-fuzzy-match t
         helm-buffers-fuzzy-matching t
         helm-recentf-fuzzy-match t
         projectile-completion-system 'helm)
   (setq helm-input-idle-delay 0.1)
   (setq my-helm-sources
		 '(helm-source-buffers-list
		   helm-source-recentf
		   helm-source-info-pages
		   helm-source-complex-command-history
		   helm-source-etags-select
		   helm-source-grep-ag
		   helm-source-bookmarks))
   (helm-adaptive-mode 1))
 #+END_SRC

 #+BEGIN_SRC emacs-lisp
 (use-package helm-descbinds
   :after helm
   :config
   (helm-descbinds-mode))
 #+END_SRC

** Gnus

 –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–µ–∑–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã:

 #+BEGIN_SRC emacs-lisp
 (defun my-gnus-zap-to-signature ()
   (interactive)
   (let ((curpos (point))
		 (endpos (re-search-forward "\n-- " nil t 1)))
	 (if (not (eq endpos nil))
		 (progn
		   (kill-region curpos (match-beginning 0))
		   (goto-char curpos)
		   (open-line 1)))))
 #+END_SRC

 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—á—Ç—É —á–µ—Ä–µ–∑ offlineimap:

 #+BEGIN_SRC emacs-lisp
 (defun my-gnus-update-news-external ()
   (interactive)
   (progn
     (message "Checking new news from external sources...")
     (shell-command "(offlineimap -o -1; notmuch new) >/dev/null 2>&1")
     (message "Checking new news from external sources... DONE")
     (gnus-group-get-new-news)))
 #+END_SRC

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±—É—Ñ–µ—Ä–∞ –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è:

#+BEGIN_SRC emacs-lisp
(defun my-message-mode-setup ()
  (when message-this-is-mail
    ;; –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–æ—á–∫–∏, –Ω–µ –≤—Å—Ç–∞–≤–ª—è—Ç—å –Ω—å—é–ª–∞–π–Ω—ã
    (turn-off-auto-fill)
    (setq fill-column 140
          visual-line-fringe-indicators '(left-curly-arrow right-curly-arrow))
    (visual-line-mode)
    (visual-fill-column-mode)))
#+END_SRC

 #+BEGIN_SRC emacs-lisp
 (use-package
   gnus
   :commands (gnus)
   :hook ((message-mode . turn-on-flyspell)
          (message-mode . my-message-mode-setup)
          (message-send . ispell-message)
          (gnus-summary-mode . hl-line-mode)
          (gnus-group-mode . hl-line-mode)
          (gnus-message-setup . mml-secure-message-sign-pgpmime))
   :bind (:map message-mode-map
               ("M-z" . my-gnus-zap-to-signature)
               :map gnus-group-mode-map
               ("M-g" . my-gnus-update-news-external))
   :config
   ;; –ù–∞–¥–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
   (require 'gnus-msg)

   ;; –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –ø–æ–ª–ª –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
   (gnus-demon-add-handler 'gnus-demon-scan-news 1200 300)
   (gnus-demon-init)

   ;; –ö–∞–∫–æ–π –±—Ä–∞—É–∑–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
   (setq gnus-button-url 'browse-url-generic
         browse-url-generic-program "chromium"
         browse-url-browser-function gnus-button-url)

   ;; –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–æ –≤—Å–µ—Ö –≥—Ä—É–ø–ø–∞—Ö –¥–µ–ª–∞—Ç—å –∫–æ–ø–∏—é –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º–æ–≥–æ –ø–∏—Å—å–º–∞ —Å–µ–±–µ
   (setq gnus-parameters
         '((".*"
            (gcc-self . t))))

   ;; –ü–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∞—Ç—Ç–∞—á–∞ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª –Ω–∞–∂–∞—Ç—å [A C], —á—Ç–æ–±—ã –≤—ã—Ç—è–Ω—É—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Ü–µ–ª–∏–∫–æ–º
   (setq nnimap-fetch-partial-articles "text/")

   ;; –û–±–Ω—É–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø–∏—Å–µ–º
   (setq gnus-select-method '(nnnil ""))

   ;; –ü–æ–¥–∫–ª—é—á–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
   (setq gnus-secondary-select-methods
         ;; –ü–æ–ª—É—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ IMAP —Å –ª–æ–∫–∞–ª—Ö–æ—Å—Ç–∞
         '((nnimap "Mail"
                   (nnimap-stream shell)
                   (nnimap-shell-program "/usr/lib/dovecot/imap"))
           ;; UNIX mailbox
           (nnmbox "LocalMBOX")))

   ;; –ü–æ–¥–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ö–æ—Å—Ç–∞
   (my-load-org-config "local/gnus-accounts.org")

   ;; –ü–æ–¥–≥—Ä—É–∑–∏—Ç—å —à–∞–±–ª–æ–Ω—ã –ø–∏—Å–µ–º
   (my-load-org-config "local/gnus-templates.org")

   ;; –°–ø–æ—Å–æ–± –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è —Ü–∏—Ç–∞—Ç—ã
   (setq message-citation-line-function 'message-insert-formatted-citation-line)

   ;; –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –º–µ—Ç–∏—Ç—å –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º–∏ (TODO —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏?)
   (setq gnus-gcc-mark-as-read t)

   ;; –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –±—É–¥–µ–º –≤ IMAP
   (setq gnus-message-archive-method
         '(nnimap "Mail"
                  (nnimap-stream shell)
                  (nnimap-shell-program "/usr/lib/dovecot/imap"))
         ;; ... –≤ –ø–∞–ø–∫—É sent
         gnus-message-archive-group "sent")

   ;; –í –Ω–∞—à–∏ —Ç—Ä—É–¥–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–∞ –Ω–∞–¥–æ —Ö–æ—Ç—è –±—ã —Å–¥–µ–ª–∞—Ç—å –≤–∏–¥, —á—Ç–æ —Ç—ã –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—à—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–ø–∏—Å–∫–∏
   (setq mml2015-use 'epg
         ;; –Ω–µ–º–Ω–æ–≥–æ –¥–µ–±–∞–≥–∞
         mml2015-verbose t
         ;; —à–∏—Ñ—Ä–æ–≤–∞—Ç—å –∏ –¥–ª—è —Å–µ–±—è
         mml-secure-openpgp-encrypt-to-self t
         ;; –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ–¥–ø–∏—Å—å –∏ —É –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π(?)
         mml-secure-openpgp-always-trust nil
         ;; –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª—å –æ—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∫–ª—é—á–µ–π
         mml-secure-cache-passphrase t
         ;; –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª—å –æ—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –Ω–∞ 10 —á–∞—Å–æ–≤
         mml-secure-passphrase-cache-expiry '36000
         ;; –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–ª—é—á –ø—Ä–∏ –ø–æ–¥–ø–∏—Å–∏ –ø–æ –∞–¥—Ä–µ—Å—É –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
         mml-secure-openpgp-sign-with-sender t
         ;; –≤—Å–µ–≥–¥–∞ —Å–ø—Ä–∞—à–∏–≤–∞—Ç—å, –Ω–∞–¥–æ –ª–∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä—Ç –ø–∏—Å—å–º–∞
         mm-decrypt-option nil
         ;; –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç—å –ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–≥–æ –ø–∞—Ä—Ç–∞
         mm-verify-option 'always)

   ;; –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä—Ç—ã –∏ –ø–æ–¥–ø–∏—Å–∏ –Ω–∞–¥–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–Ω–æ–ø–∫–æ–π
   (add-to-list 'gnus-buttonized-mime-types "multipart/signed")
   (add-to-list 'gnus-buttonized-mime-types "multipart/encrypted")

   ;; –ù–∞–≤–æ–¥–∏–º –∫—Ä–∞—Å–æ—Ç—ã
   (setq gnus-group-line-format "%M%S%5y%6t: %(%g%)\n"
         gnus-user-date-format-alist '((t . "%Y-%m-%d %H:%M"))
         gnus-summary-line-format "%U%R %&user-date; %B %[%-23,23a%] %s\n")

   (when window-system
     (setq gnus-sum-thread-tree-indent "  "
           gnus-sum-thread-tree-root "‚óè "
           gnus-sum-thread-tree-false-root "‚óØ "
           gnus-sum-thread-tree-single-indent "‚óé "
           gnus-sum-thread-tree-vertical        "‚îÇ"
           gnus-sum-thread-tree-leaf-with-other "‚îú‚îÄ‚ñ∫ "
           gnus-sum-thread-tree-single-leaf     "‚ï∞‚îÄ‚ñ∫ "))
   )
 #+END_SRC

** Dired

 –û–±–Ω–æ–≤–ª—è—Ç—å –±—É—Ñ–µ—Ä—ã dired –∞–≤—Ç–æ–º–∞—Ç–æ–º –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:

 #+BEGIN_SRC emacs-lisp
 (add-hook 'dired-mode-hook 'auto-revert-mode)
 #+END_SRC

** –°–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã

 #+BEGIN_SRC emacs-lisp
 (defun sport/equipment-report-weights (src)
   "Return summary weights grouped by buggage type"
   (let
       ((vals
         (let ((cols (- (length (first src)) 2)))
                 (seq-reduce '(lambda (sums row)
                                (mapcar*
                                 '(lambda (v s)
                                    (+ (* (number-or-v v 0) (lst-number-or-v row 1 0)) s))
                                 (nthcdr 2 row)
                                 sums))
                             (cdr src)
                             (make-list cols 0)))))
     (list
      (cons "–ò–¢–û–ì–û" (nthcdr 2 (first src)))
      'hline
      (cons (seq-reduce #'+ vals 0) vals))))

 (defun sport/equipment-report-baggage (src pos)
   "Return list for specified buggage type (column position in src table)"
   (cons
    '("" "–í–µ—Å" "–ö–æ–ª-–≤–æ")
    (cons
     'hline
     (sort 
      (remove-if-not
       '(lambda (row) (> (nth 1 row) 0))
       (map
        #'list
        '(lambda (row)
           (let ((name (first row))
                 (cnt (lst-number-or-v row pos 0)))
             (list name (* (lst-number-or-v row 1 0) cnt) cnt)))
        (cdr src)))
      (lambda (a b) (> (nth 1 a) (nth 1 b)))))))

 (defun sport/equipment-report-shared (src)
   "Return list for specified buggage type (column position in src table)"
   (cons
    '("" "–í–µ—Å" "–ö–æ–ª-–≤–æ")
    (cons
     'hline
     (sort 
       (map
        #'list
        '(lambda (row)
           (list
            (first row)
            (lst-number-or-v row 1 0)
            (lst-number-or-v row 6 0)))
        (remove-if
         '(lambda (row) (= (lst-number-or-v row 6 0) 0))
         (cdr src)))
       (lambda (a b) (string< (nth 0 a) (nth 0 b)))))))

 (defun my-sport-journal-add (type value notes)
   (interactive
    (list
     (completing-read
      "–¢–∏–ø: "
      (with-current-buffer (find-file-noselect "~/org/personal/sport/sports-periodic-TODO.org")
        (outline-show-all)
        (goto-char (point-min))
        (setq case-fold-search nil)
        (re-search-forward "^#\\+NAME: sports-journal")
        (next-line)
        (mapcar
         (lambda (row) (car (cdr row)))
         (seq-filter (lambda (row) (not (eq row 'hline))) (org-table-to-lisp)))))
     (read-string "–ó–Ω–∞—á–µ–Ω–∏–µ: ")
     (read-string "–ó–∞–º–µ—Ç–∫–∏: ")))
   ;; TODO: improve
   (with-current-buffer (find-file-noselect "~/org/personal/sport/sports-periodic-TODO.org")
     (goto-char (point-min))
     (setq case-fold-search nil)
     (re-search-forward "^#\\+NAME: sports-journal")
     (next-line)
     (goto-char (org-table-end))
     (insert
      (format "| [%s] | %s | | %s | %s |\n" (format-time-string "%F %R") type value notes))))
 #+END_SRC

** –ü—Ä–æ—á–µ–µ

*** –ö–∞–ª–µ–Ω–¥–∞—Ä—å

 #+BEGIN_SRC emacs-lisp
 (use-package
   calendar
   :ensure nil
   :config
   (setq calendar-location-name "Moscow"
         calendar-latitude 55.5
         calendar-longitude 37.4)
   ;; –•–æ—á—É —Ä—É—Å—Å–∫–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å!
   (setq calendar-week-start-day 1
		 calendar-day-abbrev-array ["–í—Å" "–ü–Ω" "–í—Ç" "–°—Ä" "–ß—Ç" "–ü—Ç" "–°–±"]
		 calendar-day-header-array calendar-day-abbrev-array
		 calendar-day-name-array ["–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ" "–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫" "–í—Ç–æ—Ä–Ω–∏–∫" "–°—Ä–µ–¥–∞" "–ß–µ—Ç–≤–µ—Ä–≥" "–ü—è—Ç–Ω–∏—Ü–∞" "–°—É–±–±–æ—Ç–∞"]
		 calendar-month-name-array ["–Ø–Ω–≤–∞—Ä—å" "–§–µ–≤—Ä–∞–ª—å" "–ú–∞—Ä—Ç" "–ê–ø—Ä–µ–ª—å" "–ú–∞–π" 
								    "–ò—é–Ω—å" "–ò—é–ª—å" "–ê–≤–≥—É—Å—Ç" "–°–µ–Ω—Ç—è–±—Ä—å"
								    "–û–∫—Ç—è–±—Ä—å" "–ù–æ—è–±—Ä—å" "–î–µ–∫–∞–±—Ä—å"]))
 #+END_SRC

 –†—É—Å—Å–∫–∏–µ –ø—Ä–∞–∑–¥–Ω–∏–∫–∏:

 #+BEGIN_SRC emacs-lisp
 (use-package
   russian-holidays
   :after (calendar)
   :config
   (setq calendar-holidays russian-holidays))

 #+END_SRC


*** –§–∏–Ω–∞–Ω—Å—ã

#+BEGIN_SRC emacs-lisp
(use-package
  org-expenses
  :load-path "~/.emacs.d/public/org-expenses"
  :bind (:map my-bindings-map
              ("C-c f" . org-expenses/expense-view))
  :config
  (setq org-expenses/files "~/org/personal"))
#+END_SRC


*** –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

#+BEGIN_SRC emacs-lisp
(defun number-or-v (n v)
  "Return V if N is not a number, or N otherwise."
  (if (not (numberp n)) v n))

(defun lst-number-or-v (lst pos v)
  "Return V if list element at POS is not a number, or (nth POS LST) otherwise."
  (number-or-v (nth pos lst) v))
#+END_SRC
